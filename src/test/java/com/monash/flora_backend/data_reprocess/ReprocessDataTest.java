package com.monash.flora_backend.data_reprocess;

import cn.hutool.core.collection.CollUtil;
import cn.hutool.core.util.StrUtil;
import com.monash.flora_backend.FLoRaBackendApplicationTests;
import com.monash.flora_backend.constant.MyMoodleConfigConstant;
import com.monash.flora_backend.dao.entity.TraceData;
import com.monash.flora_backend.service.ITraceDataService;
import com.monash.flora_backend.service_func.ActionAndProcessService;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.time.Duration;
import java.time.Instant;
import java.util.*;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * @author Xinyu Li
 * @date 2/3/2024
 */

public class ReprocessDataTest extends FLoRaBackendApplicationTests {
    @Autowired
    private ActionAndProcessService actionAndProcessService;
    @Autowired
    private ITraceDataService iTraceDataService;


    //TUM

    /*public static int[] userIdArray = {

            2746, 2711, 2691, 2726, 2714, 2717, 2712, 2716, 2715, 2718,
            2719, 2713, 2748, 2749, 2754, 2753, 2752, 2747, 2750, 2757,
            2756, 2755, 2751, 2732, 2693, 2735, 2697, 2694, 2695, 2703,
            2692, 2698, 2700, 2699, 2701, 2702, 2696, 2734, 2727, 2729,
            2739, 2738, 2728, 2730, 2733,
//            2736, // this student data cannot 5be used as he may open multiple pages at the same time, which cause data from different page generate at the same time.
            2737, 2740, 2731, 2901, 2965, 2938, 2963, 2971, 2941, 2977,
            2871, 2961, 2931, 2940, 2974, 2968, 2972, 2976, 2964, 2973,
//            2945, 2946, 2984, 2986, // this student data cannot be used as too many data loss, unfixable.
            2948, 2947, 2978, 2979, 2980, 2981, 2982, 2983, 2950, 2949, 2951, 2952,
            2953, 2954, 2706, 2707, 2985, 2987, 2988, 2885, 2873, 2876, 2881,
            2877, 2878, 2882, 2883, 2911, 2912, 2872,
            2915, 2875, 2909, 2913, 2907, 2906, 2905, 2919, 2903, 2874,
            2879, 2908, 2914, 2916, 2921, 2923, 2924, 2917, 2887, 2880
    };
    //TUM
    public static int[] courseIdArray = {64, 65, 76};*/

    // Oulu
    /*
    public static int[] userIdArray = {
            7,   8,   9,   10,  11,  14,  15,  16,  17,  18,  23,  25,  26,  34,   35,  36, 38,
            39,  40,  42,  43,  44,  45,  46,  47,  48,  49,  51,  52,  53,  54,  55,  56,  57,
            58, 255, 344, 375, 435,  this student open several pages at the same time, which causes the trace data mixed together.
            60,  61, 77,  78, 79,  80,  82, 84,  87,  88,  89,  90,  91,  92,  240, 241, 242, 244,
            245, 246, 247, 248, 249, 250, 251, 252, 253, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267,
            268, 269, 270, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 302, 303, 304, 305, 306, 307, 308,
            309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 320, 322, 323, 324, 332, 333, 334, 335, 336, 338,
            339, 340, 341, 342, 345, 346, 348, 349, 350, 352, 353, 354, 355, 356, 357, 358, 360, 361, 362,
            363, 364, 365, 366, 367, 368, 370, 371, 372, 373, 374, 376, 377, 379, 380, 381, 382, 384, 385,
            386, 397, 398, 399, 400, 402, 403, 405, 406, 407, 408, 409, 410, 411, 413, 414, 415, 416, 417, 418,
            419, 420, 422, 423, 424, 426, 427, 429, 430, 431, 432, 434, 436, 458, 459, 460, 461, 462, 463
            53, 305 //这两个是测试用
    };
    // Oulu
    public static int[] courseIdArray = {16, 17}; //6, 15, 16, 17, 18*/

//    // Radboud 新的 2025 年2月的pilot study
    /*
    public static int[] userIdArray = {
//            3279, 3280, 3282, 3284, 3285, 3286, 3287, 3289, 3291, 3294,
//            3296, 3299, 3300, 3304, 3305, 3306, 3307, 3309, 3310, 3311,
//            3312, 3313, 3323, 3323, 3324, 3325, 3327, 3328, 3329, 3329,
//            3333, 3338, 3338, 3339, 3339, 3340, 3341, 3342, 3343, 3344,
//            3347, 3347
//        3341,3342,3344, 3345
        3403,3404,3405,3406,3407,3408,3409,3410,3411,3412,3413,
        3414,3415,3416,3417,3418,3419,3420,3421,3423,3424,
        3425,3426,3494,3495,3496,3498,3499,3500,3501,3502,
        3544,3545,3546,3547,3548,3549,3550,3551,3552,3553,
        3554,3555,3556,3557,3558
    };
    public static int[] courseIdArray = {98, 101, 104, 105};*/

    // Radboud
    /*
    public static int[] userIdArray = {
            1732, 1733, 1734,
            1735, 2004, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2021, 2022, 2023,
            2024, 2030, 2061, 2105, this student open several pages at the same time, which causes the trace data mixed together.
            2025, 2026, 2027, 2028, 2029, 2031, 2032, 2033, 2034, 2035, 2036, 2037, 2038, 2039, 2040, 2041, 2042, 2043, 2045, 2046, 2047, 2048, 2049, 2050, 2051, 2052, 2053, 2054, 2055, 2056, 2057,
            2058, 2059, 2060, 2062, 2063, 2064, 2065, 2066, 2067, 2068, 2069, 2070, 2071, 2072, 2073, 2074, 2076,
            2077, 2079, 2080, 2081, 2082, 2083, 2084, 2086, 2087, 2088, 2089, 2090, 2091, 2092, 2094, 2095, 2096, 2097, 2098, 2099, 2100, 2101,
            2102, 2104, 2107, 2108, 2109, 2110, 2111, 2112, 2113,
            2114, 2117, 2118, 2119, 2120, 2140, 2141, 2142, 2145, 2274,  test accounts, have too many issues
            2121, 2123, 2124, 2125, 2126, 2143, 2144, 2146, 2170, 2171, 2172, 2174, 2175, 2176, 2177, 2178, 2264, 2265, 2266, 2267, 2268, 2269, 2270, 2271, 2272, 2275, 2276, 2277, 2278,
            2280, 2281, 2282, 2283, 2284, 2287, 2288, 2289, 2290, 2291, 2292, 2293, 2294, 2303, 2304, 2305, 2306, 2309, 2310, 2311, 2312, 2494, 2495, 2496, 2497, 2498, 2499, 2500, 2501, 2502, 2503, 2504, 2505, 2506, 2507, 2508, 2509, 2510, 2511, 2512, 2514,
            2515, 2516, 2517, 2519, 2520, 2524, 2525, 2526, 2527, 2528, 2529, 2530, 2531, 2532, 2533, 2534, 2535, 2536, 2537, 2538, 2539, 2540, 2541,
            2542, 2543, 2544, 2545, 2546, 2554, 2555, 2556, 2557, 2558, 2559, 2560, 2561, 2562, 2563, 2564, 2565, 2566, 2567, 2568, 2569, 2570, 2571, 2572,
            2573, 2574, 2575, 2576, 2577, 2578, 2579, 2580, 2584, 2585, 2586, 2587, 2588, 2589, 2590, 2591, 2592, 2594, 2595, 2596, 2598, 2599, 2600, 2601, 2602, 2604, 2605,
            2606, 2607, 2608, 2609, 2610, 2611, 2612
    };
    public static int[] courseIdArray = {25, 40};*/

    //Tony Beijing data 359
    /*public static int[] userIdArray = {
            1575, 1577, 1579, 1580, 1583, 1584, 1585, 1586, 1587, 1588, 1590, 1591, 1592, 1594, 1597, 1598, 1599, 1600, 1602, 1605,
            1606, 1607, 1608, 1610, 1612, 1615, 1617, 1618, 1619, 1621, 1622, 1624, 1626, 1628, 1629, 1630, 1631, 1632, 1633, 1634,
            1640, 1642, 1643, 1644, 1645, 1646, 1648, 1652, 1655, 1656, 1659, 1660, 1661, 1664, 1665, 1666, 1667, 1669, 1671, 1672,
            1673, 1674, 1676, 1677, 1680, 1681, 1682, 1683, 1684, 1685, 1686, 1688, 1689, 1691, 1692, 1694, 1695, 1696, 1697, 1698,
            1699, 1700, 1703, 1704, 1705, 1706, 1707, 1708, 1709, 1710, 1711, 1712, 1713, 1717, 1718, 1719, 1720, 1721, 1722, 1724,
            1725, 1726, 1729, 1730, 1731, 1732, 1733, 1734, 1735, 1736, 1737, 1738, 1739, 1740, 1741, 1745, 1747, 1748, 1749, 1750,
            1751, 1752, 1753, 1754, 1756, 1759, 1760, 1761, 1762, 1763, 1764, 1765, 1766, 1768, 1769, 1770, 1775, 1779, 1780, 1781,
            1782, 1784, 1785, 1787, 1788, 1790, 1795, 1797, 1798, 1799, 1800, 1801, 1802, 1804, 1805, 1806, 1807, 1808, 1809, 1811,
            1812, 1813, 1814, 1816, 1817, 1819, 1820, 1821, 1824, 1825, 1826, 1827, 1830, 1831, 1832, 1835, 1836, 1837, 1838, 1839,
            1844, 1845, 1847, 1848, 1849, 1850, 1851, 1852, 1854, 1858, 1860, 1862, 1863, 1864, 1865, 1866, 1867, 1868, 1869, 1871,
            1873, 1876, 1877, 1878, 1882, 1883, 1884, 1885, 1887, 1888, 1889, 1891, 1892, 1894, 1896, 1897, 1899, 1902, 1903, 1904,
            1906, 1907, 1911, 1913, 1914, 1915, 1916, 1918, 1919, 1922, 1923, 1924, 1925, 1926, 1929, 1931, 1932, 1933, 1934, 1936,
            1937, 1938, 1939, 1941, 1942, 1943, 1962, 1969, 1987, 1988, 1990, 1991, 1992, 1993, 1994, 1995, 2265, 2266, 2267, 2268,
            2269, 2270, 2272, 2273, 2274, 2275, 2276, 2277, 2278, 2280, 2281, 2282, 2315, 2316, 2317, 2318, 2319, 2324, 2325, 2326,
            2329, 2330, 2331, 2332, 2333, 2334, 2335, 2336, 2338, 2340, 2341, 2342, 2343, 2382, 2413, 2414, 2415, 2416, 2444, 2445,
            2446, 2534, 2535, 2536, 2537, 2538, 2539, 2541, 2542, 2543, 2544, 2545, 2547, 2548, 2549, 2550, 2551,

            1601, 1613, 1614, 1616, 1649, 1650, 1653, 1654, 1657, 1663, 1693, 1701, 1727, 1746, 1773, 1778, 1803, 1823, 1833, 1840, 1842,1846, 1856, 1870, 1908, 1909, 1910, 1917, 1921, 1927, 1928, 1960, 1989,  //同时开多个页面，导致log错误
            2271, 2279, 2339, 2344, 2443,2448, 2533, 2546, 2552  //同时开多个页面，导致log错误
};
    public static int[] courseIdArray = {73, 74, 75};*/

    // TUM data 30 个
    /*
    public static int[] userIdArray = {
            3102, 3100, 3101, 3103, 3104, 3105, 3107, 3106, 3110, 3109,
            3108, 3113, 3111, 3112, 3115, 3114, 3116, 3117, 3118, 3126,
            3125, 3127, 3128, 3129, 3130, 3131, 3132, 3134, 3133, 3135
    };
    public static int[] courseIdArray = {84, 42};*/

    //Legacy Cella study 1 Monash Data, 可以直接执行，数据清理从step0开始

    public static int[] userIdArray = {
            /*// India
            2525, 2526, 2527, 2528, 2529, 2530, 2531, 2532, 2533, 2534, 2535, 2536, 2555, 2556, 2557,
            2558, 2559, 2560, 2561, 2562, 2563, 2564, 2565, 2566, 2585, 2586, 2587, 2588, 2589, 2590,
            2591, 2592, 2593, 2594, 2595, 2596, 2597, 2615, 2616, 2617, 2618, 2619, 2620, 2621, 2622,
            2645, 2646, 2647, 2648, 2649, 2650, 2651, 2652, 2675, 2676, 2677, 2678, 2679, 2680, 2681,
            2682, 4753, 4754, 4755, 4756, 4757, 4758, 4759, 4766, 4767, 4768, 4769, 4770, 4778, 4779,
            4780, 4781, 4782, 4783, 4784, 4791, 4792, 4793, 4794, 4803, 4804, 4805, 4806, 4807, 4808,
            4809, 4810, 4817, 4818, 4819, 4820, 4821, 4823,

            //Emmaus
            2070, 2071, 2072, 2073, 2074, 2075, 2076, 2077, 2078, 2079, 2080, 2081, 2115, 2116, 2117,
            2118, 2119, 2120, 2121, 2122, 2123, 2124, 2126, 2170, 2171, 2172, 2173, 2174, 2175, 2176,
            2177, 2178, 2180, 2181, 2182,
            //Mazenod
            2707, 2710, 2711, 2712, 2724, 2725, 2726, 2727, 2728, 2729, 2739, 2740, 2741, 2742, 2743,
            2744,
            //St John
            1695, 1696, 1697, 1698, 1699, 1700, 1701, 1702, 1703, 1704, 1705, 1706, 1707, 1708, 1709,
            1710, 1711, 1712, 1713, 1714, 1715, 1716, 1717, 1718, 1719, 1720, 1721, 1722, 1723, 1724,
            1727, 1728, 1729, 1730, 1735, 1741, 1812*/

            //UAE
            /*594, 601, 605, 608, 609, 610, 614, 617, 619, 621, 622, 626, 627, 628, 630,
            631, 633, 635, 638, 640, 643, 648, 649, 650, 651, 655, 657, 658, 660, 662,
            663, 664, 672, 675, 676, 678, 682, 688, 793, 794, 795, 796, 798, 801, 802,
            808, 809, 811, 814, 818, 819, 820, 821, 822, 823, 824, 825, 826, 827, 828,
            831, 833, 834, 835, 838, 839, 845, 851, 854, 856, 857, 859, 860, 861, 862,
            863, 864, 867, 869, 872, 876, 877, 878, 882, 888, 889, 890, 891, 892, 893,
            894, 902, 903, 905, 907, 908, 909, 910, 912, 913, 915, 917, 927, 933, 934,
            938, 939, 941, 943, 944, 945, 947, 948, 958, 967, 972, 976, 977, 979, 983,
            984, 985, 986, 987, 989, 990, 991, 993, 994, 995, 998, 999, 1000, 1003, 1006,
            1017, 1025, 1037, 1038, 1043, 1044, 1046, 1047, 1056, 1058, 1078, 1079, 1080, 1081, 1090*/

            //Brazil
            /*471, 472, 474, 476, 477, 478, 481, 482, 483, 486, 488, 489, 490, 492, 494,
            495, 496, 497, 498, 499, 503, 518, 519, 521, 523, 524, 525, 528, 533, 536,
            537, 538, 539, 543, 544, 545, 546, 547, 549, 551, 552, 553, 571, 573, 574,
            575, 576, 581, 585, 588, 593, 594, 595, 597, 598, 601, 858, 860, 861, 862,
            864, 865, 866, 867, 868, 869, 870, 878, 879, 880, 882, 883, 884, 885, 887,
            888, 889, 890, 898, 899, 900, 901, 902, 903, 904, 905, 906, 907, 910*/

            //Colombia Edu
            /*318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332,
            334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348,
            349, 350, 351, 352, 353, 354, 356, 358, 360, 361, 362, 363, 365, 366, 367,
            368, 369, 370, 371, 372, 373, 374, 375, 376, 379, 380, 381, 382, 383, 384,
            385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 396, 397, 398, 399, 400,
            401, 402, 405, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419,
            420, 421, 422, 423, 424,

            //Colombia Medicine
            168, 169, 170, 171, 172, 173, 174, 175, 178, 179, 180, 181, 182, 183, 184,
            185, 186, 187, 188, 189, 190, 191, 192, 196, 200, 201, 202, 204, 205, 206,
            207, 208, 209, 218, 219, 220, 221, 223, 225, 228, 229, 230, 231, 232, 233,
            234, 235, 236, 237, 238, 239, 240, 241, 242, 250, 251, 252, 253, 254, 255,
            256, 257, 258, 259, 267, 268, 271, 272, 273, 274, 275, 276, 277, 278, 279,
            280, 281, 282, 284, 286, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297,
            298, 299, 300, 301, 302, 315, 316,*/

            //Beijing Medical
    /*
            1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
            2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2024, 2025, 2026,
            2027, 2028, 2029, 2030, 2031, 2032, 2033, 2034, 2035, 2036, 2037, 2038, 2039, 2040, 2041,
            2042, 2043, 2044, 2045, 2046, 2047, 2048, 2049, 2050, 2051, 2052, 2053, 2054, 2055, 2056,
            2057, 2058, 2059, 2060, 2061, 2062, 2063, 2064, 2065, 2066, 2067, 2068, 2069, 2070, 2071,
            2072, 2073, 2074, 2075, 2076, 2077, 2078, 2079, 2080, 2081, 2082, 2083, 2084, 2085, 2086,
            2087, 2088, 2089, 2090, 2091, 2092, 2093, 2094, 2095, 2096, 2097, 2098, 2099, 2100, 2101,
            2102, 2103, 2104, 2105, 2106, 2107, 2108, 2109, 2110, 2111, 2112, 2113, 2114, 2116, 2117,
            2118, 2119, 2120, 2121, 2122, 2123, 2124, 2125, 2126, 2127, 2128, 2129, 2130, 2131, 2132,
            2133, 2134, 2135, 2136, 2137, 2138, 2139, 2140, 2141, 2142, 2143, 2144, 2145, 2146, 2147,
            2148, 2149, 2150, 2151, 2152, 2153, 2154, 2155, 2156, 2157, 2158, 2159,
            2160, 2161, 2162,
            2163, 2164, 2165, 2166, 2167, 2168, 2169, 2170, 2171, 2172, 2173, 2174, 2175, 2176, 2177,
            2178, 2179, 2180, 2181, 2182, 2183, 2184, 2185, 2186, 2187, 2188, 2189, 2190, 2191, 2192,
            2193, 2194, 2195, 2196, 2197, 2199, 2200, 2201, 2202, 2203, 2204, 2205, 2206*/

        // NTCU
        /*225, 226, 228, 229, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291,
        292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311,
        312, 313, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 330, 331, 332, 333, 334, 335, 336, 337,
        338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358,
        359, 360, 361, 362, 364, 365, 366, 367, 368, 371, 372, 373, 374, 375, 376, 377, 379, 381, 382, 383,
        384, 385, 386, 387, 388, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405,
        407, 408, 409, 410, 411, 412, 413, 414, 416, 417, 418, 419, 420, 421, 422, 424, 425, 426, 427, 428,
        429, 430, 432, 436, 437*/

            //Monash FIT5145
        /*
        3572, 3384, 3579, 3582, 3446, 3672, 3711, 3470, 3612, 3386, 3397, 3761, 3329, 3546, 3548, 3566, 3654, 3536, 3520, 3624,
        3353, 3563, 3542, 3592, 3387, 3301, 3365, 3760, 3357, 3476, 3477, 3775, 3656, 3420, 3678, 3380, 3719, 3764, 3655, 3505,
        3392, 3369, 3644, 3662, 3641, 3648, 3703, 3611, 3661, 3361, 3573, 3652, 3423, 3687, 3358, 3444, 3456, 3771, 3700, 3763,
        3429, 3340, 3271, 3355, 3599, 3721, 3553, 3752, 3485, 3436, 3407, 3570, 3331, 3571, 3772, 3617, 3776, 3692, 3403, 3605,
        3487, 3342, 3406, 3664, 3632, 3293, 3499, 3451, 3755, 3723, 3699, 3551, 3597, 3753, 3320, 3708, 3554, 3549, 3440, 3458,
        3649, 3519, 3347, 3562, 3757, 3705, 3643, 3390, 3726, 3701, 3620, 3351, 3415, 3467, 3744, 3576, 3367, 3464, 3373, 3544,
        3289, 3663, 3547, 3402, 3622, 3682, 3540, 3585, 3658, 3645, 3691, 3659, 3539, 3530, 3545, 3651, 3496, 3428, 3689, 3715,
        3668, 3616, 3587, 3370, 3681, 3669, 3388, 3674, 3578, 3350, 3498, 3450, 3685, 3603, 3416, 3695, 3413, 3459, 3480, 3779,
        3393, 3593, 3338, 3326, 3748, 3409, 3555, 3565, 3714, 3280, 3602, 3445, 3372, 3475, 3606, 3424, 3379, 3517, 3561, 3472,
        3707, 3394, 3460, 3557, 3356, 3677, 3507, 3457, 3758, 3628, 3613, 3343, 3756, 3474, 3295, 3521, 3396, 3411, 3683, 3482,
        3600, 3552, 3725, 3635, 3680, 3412, 3492, 3559, 3650, 3471, 3735, 3609, 3647, 3501, 3442, 3627, 3601, 3493, 3497, 3633,
        3670, 3686, 3729, 3610, 3448, 3575, 3511, 3488, 3728, 3449, 3646, 3638, 3452, 3426, 3483, 3684, 3432, 3368, 3608, 3398,
        3676, 3596, 3673, 3274, 3590, 3273, 3455, 3738, 3598, 3284, 3524, 3518, 3556, 3537, 3362, 3586, 3490, 3568, 3500, 3534,
        3489, 3591, 3447, 3702, 3532, 3523, 3751, 3713, 3588, 3325, 3697, 3466, 3378, 3382, 3604, 3352, 3395, 3564, 3660, 3666,
        3311, 3431, 3522, 3400, 3526, 3754, 3486*/

        //TUM cella 3
        3698, 3699, 3700, 3701, 3702, 3703, 3704, 3705, 3706, 3707, 3708, 3709, 3710, 3711, 3712, 3713, 3714, 3715, 3716, 3717,
        3718, 3723, 3724, 3725, 3726, 3727, 3728, 3729, 3730, 3731, 3732, 3741, 3742, 3743, 3744, 3745, 3746, 3747, 3748, 3749,
        3750, 3751, 3752, 3753, 3754, 3755, 3756, 3757, 3758, 3759, 3760, 3762, 3763, 3764, 3765, 3766, 3767, 3768, 3769, 3770,
        3771, 3772, 3773, 3777, 3778, 3779, 3780, 3781, 3782, 3783, 3785, 3786, 3787, 3788, 3789, 3790, 3791, 3795, 3796, 3797,
        3798, 3799, 3800, 3801, 3802, 3803, 3804, 3805, 3806, 3807, 3808, 3809, 3811, 3812, 3813, 3815, 3816, 3817, 3818, 3819,
        3820, 3821, 3822, 3823, 3824, 3825, 3826, 3827, 3828, 3829, 3830, 3831, 3832, 3833, 3834, 3835, 3837, 3838, 3839, 3840,
        3841, 3842, 3843, 3845, 3846, 3847
    };
    public static int[] courseIdArray = {
//            26 // FIT5145
//            20, 21, 4 //Monash
//            10, 11, 12 //UAE
//            15,16,17, //Brazil
//            5, //Colombia Edu
//            8,9,10 // Colombia Medicine
//            59, 60, 61, 62, 63, 64, 65, 66, 85, 86 // Beijing Medical
//            16,24,25,18,19,20 //NTCU
            65, 76, 118 // TUM cella 3
    };




    /*public static int[] userIdArray = {
            1203, 1206, 1208, 1209, 1210, 1211, 1212, 1213, 1214, 1215, 1215, 1216, 1217, 1218, 1219, 1221, 1225, 1226, 1227, 1228,
            1229, 1230, 1231, 1232, 1233, 1234, 1235, 1236, 1237, 1238, 1239, 1240, 1241, 1243, 1244, 1245, 1246, 1247, 1248, 1249,
            1250, 1251, 1252, 1253, 1254, 1255, 1256, 1257, 1258, 1259, 1260, 1261, 1262, 1263, 1264, 1265, 1268, 1269, 1270, 1271,
            1272, 1274, 1275, 1277, 1278, 1279, 1280, 1281, 1282, 1283, 1285, 1286, 1287, 1288, 1289, 1290, 1291, 1293, 1294, 1295,
            1296, 1297, 1299, 1300, 1302, 1304, 1305, 1308, 1309, 1311, 1312, 1314, 1315, 1316, 1317, 1318, 1320, 1321, 1323, 1324,
            1326, 1327, 1327, 1328, 1329, 1330, 1331, 1332, 1333, 1334, 1335, 1336, 1337, 1339, 1340, 1341, 1342, 1343, 1344, 1345,
            1346, 1347, 1348, 1350, 1353, 1354, 1355, 1356, 1357, 1358, 1360, 1361, 1362, 1363, 1364, 1365, 1366, 1367, 1368, 1369,
            1370, 1371, 1372, 1373, 1375, 1377, 1378, 1379, 1380, 1381, 1382, 1383, 1384, 1386, 1387, 1388, 1389, 1390, 1391, 1393,
            1394, 1396, 1397, 1399, 1402, 1403, 1404, 1405, 1406, 1407, 1411, 1412, 1414, 1415, 1417, 1418, 1419, 1421, 1422, 1424,
            1425, 1426, 1427, 1429, 1432, 1433, 1434, 1435, 1436, 1437, 1438, 1439, 1440, 1441, 1442, 1443, 1444, 1446, 1447, 1448,
            1449, 1450, 1451, 1452, 1453, 1454, 1456, 1457, 1458, 1459, 1460, 1461, 1462, 1463, 1464, 1466, 1467, 1468, 1469, 1470,
            1471, 1472, 1473, 1474, 1477, 1478, 1479, 1480, 1481, 1482, 1483, 1484, 1485, 1486, 1487, 1491, 1494, 1495, 1496, 1497,
            1499, 1500, 1501, 1502, 1503, 1504, 1506, 1527
            };
    public static int[] courseIdArray = {38};*/

    //Saleh study
    /*public static int[] userIdArray = {
            1245, 1247, 1248, 1249, 1250, 1251, 1252, 1253, 1254, 1255, 1256, 1257, 1258, 1259, 1260, 1261, 1262, 1263, 1264, 1265,
            1266, 1267, 1268, 1269, 1270, 1271, 1272, 1274, 1275, 1276, 1277, 1278, 1279, 1280, 1281, 1282, 1283, 1284, 1285, 1286,
            1287, 1288, 1289, 1290, 1291, 1292, 1293, 1294, 1295, 1296, 1297, 1298, 1299, 1300, 1301, 1302, 1303, 1304, 1305, 1306,
            1307, 1308, 1309, 1310, 1311, 1312, 1313, 1314, 1315, 1316, 1317, 1318, 1319, 1320, 1321, 1322, 1323, 1324, 1325, 1326,
            1327, 1328, 1329, 1330, 1331, 1332, 1333, 1334, 1335, 1336, 1337, 1338, 1339, 1340, 1341, 1342, 1343, 1344, 1345, 1346,
            1347, 1348, 1349, 1350, 1351, 1352, 1353, 1354, 1355, 1356, 1358, 1359, 1360, 1361, 1362, 1363, 1364, 1365, 1366, 1367,
            1368, 1369, 1370, 1371, 1372, 1373, 1374, 1375, 1376, 1377, 1378, 1379, 1380, 1381, 1382, 1383, 1384, 1385, 1386, 1387,
            1388, 1389, 1390, 1391, 1392, 1393, 1394, 1395, 1396, 1397, 1399, 1400, 1401, 1402, 1403, 1404, 1506, 1507, 1508, 1509,
            1510, 1511, 1513, 1514, 1517, 1520, 1521, 1523, 1525, 1527, 1528, 1530, 1531, 1532, 1556, 1557, 1558, 1559, 1560, 1563,
            1564, 1566, 1568, 1570, 1573, 1574, 1575, 1576, 1578, 1580, 1581, 1602, 1603, 1604};
    public static int[] courseIdArray = {23,28};*/

    //Beijing Cella study 2025
    /*public static int[] userIdArray = {
            3511,3512,3513,3514,3515,3516,3517,3518,3519,3520,
            3521,3522,3524,3525,3526,3527,3529,3530,3531,3532,
            3533,3534,3535,3536,3537,3538,3539,3540,3541,3542,
            3543,3544,3558,3561,3562,3563,3564,3566,3567,3568,
            3570,3571,3572,3573,3574,3575,3576,3577,3578,3579,
            3580,3581,3582,3583,3584,3585,3586,3587,3588,3589,
            3590,3591,3592,3593,3594,3595,3596,3597,3598,3599,
            3600,3601,3604,3605,3606,3611,3612,3613,3614,3615,
            3616,3617,3618,3619,3620,3621,3622,3623,3624,3625,
            3626,3627,3628,3629,3630,3631,3632,3633,3634,3635,
            3636,3637,3638,3639,3640,3641,3642,3643,3644,3645,
            3646, 3647, 3648, 3649, 3650, 3651, 3652, 3654, 3659, 3660,

            3829, 3827, 3826, 3828, 3833, 3883, 3832, 3830, 3931, 3882,
            3831, 3834, 3881, 3879, 3926, 3880, 3876, 3930, 3935, 3888,
            3839, 3939, 3836, 3937, 3835, 3886, 3938, 3889, 3837, 3936,
            3887, 3838, 3844, 3897, 3898, 3840, 3892, 3900, 3946, 3851,
            3846, 3841, 3848, 3944, 3943, 3950, 3847, 3894, 3940, 3845,
            3901, 3895, 3843, 3942, 3849, 3842, 3899, 3951, 3947, 3893,
            3941, 3945, 3850, 3891, 3890, 3952, 3949, 3896, 3907, 3959,
            3908, 3958, 3957, 3932, 3948, 3852, 3956, 3955, 3929, 3904,
            3902, 3933, 3975, 3903, 3909, 3953, 3905, 3910, 3854, 3954,
            3928, 3969, 3973, 3912, 3966, 3913, 3968, 3870, 3869, 3918,
            3917, 3919, 3865, 3964, 3866, 3974, 3920, 3861, 3972, 3862,
            3868, 3963, 3922, 3872, 3863, 3871, 3911, 3962, 3921, 3970,
            3916, 3915, 3864, 3965, 3971, 3961, 3967, 3867,
    };

    public static int[] courseIdArray = {76, 81, 82};*/

    //Norah study
    /*public static int[] userIdArray = {1615, 1616, 1617, 1618, 1619, 1620, 1621, 1622, 1623, 1624, 1625, 1626, 1627, 1628, 1629, 1630, 1631, 1632, 1633, 1634,
            1635, 1636, 1637, 1638, 1639, 1640, 1641, 1642, 1643, 1644, 1645, 1646, 1647, 1648, 1649, 1650, 1651, 1652, 1653, 1654,
            1655, 1656, 1657, 1658, 1659, 1660, 1661, 1662, 1663, 1664, 1665, 1666, 1667, 1668, 1669, 1670, 1671, 1672, 1673, 1674,
            1675, 1676, 1677, 1678, 1679, 1680, 1681, 1682, 1683, 1684, 1685, 1686, 1687, 1688, 1689, 1690, 1691, 1692, 1693, 1694,
            1695, 1696, 1697, 1698, 1699, 1700, 1701, 1702, 1703, 1704, 1705, 1706, 1707, 1708, 1709, 1710, 1711, 1712, 1713, 1714,
            1715, 1716, 1717, 1718, 1719, 1720, 1721, 1722, 1723, 1724, 1725, 1726, 1727, 1728, 1729, 1730, 1731, 1732, 1733, 1734,
            1735, 1736, 1737, 1738, 1739, 1740, 1741, 1742, 1743, 1744, 1745, 1746, 1747, 1748, 1749, 1750, 1751, 1752, 1753, 1754,
            1755, 1756, 1757, 1758, 1759, 1760, 1761, 1762, 1763, 1764, 1765, 1766, 1767, 1768, 1769, 1770, 1771, 1772, 1773, 1774,
            1775, 1776, 1777, 1778, 1779, 1780, 1781, 1782, 1783, 1784, 1785, 1786, 1787, 1788, 1789, 1790, 1791, 1792, 1793, 1794,
            1795, 1796, 1797, 1798, 1799, 1800, 1801, 1802, 1803, 1804, 1805, 1806, 1807, 1808, 1809, 1810, 1811, 1812, 1813, 1814,
            1815, 1816, 1817, 1818, 1819, 1820, 1821, 1822, 1823, 1824, 1825, 1826, 1827, 1828, 1829, 1830, 1831, 1832, 1833, 1834,
            1835, 1836, 1837, 1838, 1839, 1840, 1841, 1842, 1843, 1844, 1845, 1846, 1847, 1848, 1849, 1850, 1851, 1852, 1853, 1854,
            1855, 1856, 1857, 1858, 1859, 1860, 1861, 1862, 1863, 1864, 1865, 1866, 1867, 1868, 1869, 1870, 1871, 1872, 1873, 1874,
            1875, 1876, 1877, 1878, 1879, 1880, 1881, 1882, 1883, 1884, 1885, 1886, 1887, 1888, 1889, 1890, 1891, 1892, 1893, 1894,
            1895, 1896, 1897, 1898, 1899, 1900, 1901, 1902, 1903, 1904, 1905, 1906, 1907, 1908, 1909, 1910, 1911, 1912, 1913, 1914,
            2368, 2369, 2370, 2371, 2372, 2373, 2374, 2375, 2376, 2377, 2378, 2379, 2380, 2381, 2382, 2383, 2384, 2385, 2386, 2387,
            2388, 2389, 2390, 2391, 2392, 2393, 2394, 2395, 2396, 2397, 2398, 2399, 2400, 2401, 2402, 2403, 2404, 2405, 2406, 2407,
            2408, 2409, 2410, 2411, 2412, 2413, 2414, 2415, 2416, 2417, 2418, 2419, 2420, 2421, 2422, 2423, 2424, 2425, 2426, 2427,
            2428, 2429, 2430, 2431, 2432, 2433, 2434, 2435, 2436, 2437, 2438, 2439, 2440, 2441, 2442, 2443, 2444, 2445, 2446, 2447,
            2448, 2449, 2450, 2451, 2452, 2453, 2454, 2455, 2456, 2457, 2458, 2459, 2460, 2461, 2462, 2463, 2464, 2465, 2466, 2467,
            2468, 2469, 2470, 2471, 2472, 2473, 2474, 2475, 2476, 2477, 2478, 2479, 2480, 2481, 2482, 2483, 2484, 2485, 2486, 2487,
            2488, 2489, 2490, 2491, 2492, 2493, 2494, 2495, 2496, 2497, 2498, 2499, 2500, 2501, 2502, 2503, 2504, 2505, 2506, 2507,
            2508, 2509, 2510, 2511, 2512, 2513, 2514, 2515, 2516, 2517, 2518, 2519, 2520, 2521, 2522, 2523, 2524, 2525, 2526, 2527,
            2528, 2529, 2530, 2531, 2532, 2533, 2534, 2535, 2536, 2537, 2538, 2539, 2540, 2541, 2542, 2543, 2544, 2545, 2546, 2547,
            2548, 2549, 2550, 2551, 2552, 2553, 2554, 2555, 2556, 2557, 2558, 2559, 2560, 2561, 2562, 2563, 2564, 2565, 2566, 2567,
            2568, 2569, 2570, 2571, 2572, 2573, 2574, 2575, 2576, 2577, 2578, 2579, 2580, 2581, 2582, 2583, 2584, 2585, 2586, 2587,
            2588, 2589, 2590, 2591, 2592, 2593, 2594, 2595, 2596, 2597, 2598, 2599, 2600, 2601, 2602, 2603, 2604, 2605, 2606, 2607,
            2608, 2609, 2610, 2611, 2612, 2613, 2614, 2615, 2616, 2617, 2618, 2619, 2620, 2621, 2622, 2623, 2624, 2625, 2626, 2627,
            2628, 2629, 2630, 2631, 2632, 2633, 2634, 2635, 2636, 2637, 2638, 2639, 2640, 2641, 2642, 2643, 2644, 2645, 2646, 2647,
            2648, 2649, 2650, 2651, 2652, 2653, 2654, 2655, 2656, 2657, 2658, 2659, 2660, 2661, 2662, 2663, 2664, 2665, 2666, 2667,
            2668, 2669, 2670, 2671, 2672, 2673, 2674, 2675, 2676, 2677, 2678, 2679, 2680, 2681, 2682, 2683, 2684, 2685, 2686, 2687,
            2688, 2689, 2690, 2691, 2692, 2693, 2694, 2695, 2696, 2697, 2698, 2699, 2700, 2701, 2702, 2703, 2704, 2705, 2706, 2707,
            2708, 2709, 2710, 2711, 2712, 2713, 2714, 2715, 2716, 2717, 2718, 2719, 2720, 2721, 2722, 2723, 2724, 2725, 2726, 2727,
            2728, 2729, 2730, 2731, 2732, 2733, 2734, 2735, 2736, 2737, 2738, 2739, 2740, 2741, 2742, 2743, 2744, 2745, 2746, 2747,
            2748, 2749, 2750, 2751, 2752, 2753, 2754, 2755, 2756, 2757, 2758, 2759, 2760, 2761, 2762, 2763, 2764, 2765, 2766, 2767};
    public static int[] courseIdArray = {31, 38, 46};*/
    /**
     * step 0
     * removeTryOutToolsAndFixSubActionLabelAndNoActionLabelIssue
     * 可以自动执行
     * 使用sql script 执行
     */
    @Test
    public void removeTryOutToolsAndFixSubActionLabelAndNoActionLabelIssue() {
//        Nijmenge server
        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("247", "225", "471", "284", "303", "322", "182", "402", "647", "705", "726", "768", "754"));
        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("248", "226", "470", "285", "304", "323", "183", "403", "648", "706", "727", "769", "755"));
        //Oulu server
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("28",         "49", "89", "77",      "119", "101"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of(          "29",         "50", "90", "78",      "120", "102"));
        //Tony data
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("895", "914", "933"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("896", "915", "934"));
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of("1113", "1114", "1115"));

        //Beijing server
//        MyMoodleConfigConstant.IRRELEVANT_READING_PAGE_ID_SET.addAll(Set.of("10", "12", "19", "21", "24", "38", "40", "47", "49", "52", "64", "66", "73", "75", "78", "355", "357", "364", "366", "369"));
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("7", "35", "61", "351", "491", "576", "933", "914", "895", "952", "1010", "1027", "775", "655", "1053", "1083", "805", "685", "835", "715"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("8", "36", "62", "352", "573", "577", "934", "915", "896", "953", "1011", "1028", "776", "656", "1054", "1084", "806", "685", "836", "716"));
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of("1046", "1047", "1048", "869", "870", "1113", "1114", "1115"));


        //Legacy Cella study 1 Monash Data
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("5"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of(          "6"));

        //Legacy Cella study 1 Oulu Data  course id: 1002
        //Legacy Cella study 1 TUM Data   course id: 1001
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("15"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of(          "12"));

        //Monash Server
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("8", "31", "118", "136", "154", "172", "294", "301", "307"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("9", "32", "119", "137", "155", "173", "295", "302", "308"));
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of("196", "197", "198"));

        //UAE
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("91", "109", "127", "311", "333", "362", "657", "750"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("92", "110", "128",           "312", "334", "363", "658", "751"));
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of("90", "108", "126",          "349", "350", "361", "656", "749"));
        //Latin America
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of(                     "32", "70", "88", "106", "157", "175", "193"));
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("14", "32", "50", "68", "86", "104", "158", "176", "194"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of(          "15", "33", "51", "69", "87", "105", "159", "177", "195"));

        // Arabic Server
//        MyMoodleConfigConstant.TASK_REQUIREMENT_READING_PAGE_ID_SET.addAll(Set.of("91", "109", "127", "311", "333"));
//        MyMoodleConfigConstant.RUBRIC_READING_PAGE_ID_SET.addAll(Set.of("92", "110", "128", "312", "334"));
//        MyMoodleConfigConstant.WELCOME_READING_PAGE_ID_SET.addAll(Set.of("90", "108", "126", "349", "350"));

        String currentUrl = "";
//        for (int i = 0; i < beijingUserCourseId.length; i++) {

//            int userId = beijingUserCourseId[i][0];
//            int courseId = beijingUserCourseId[i][1];
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];

                List<TraceData> needUpdateTraceList = new ArrayList<>();
                System.out.println("processing " + userId + "-----courseid:" + courseId);
                // 将所有try_out_tools 都改成 原本的label
                List<TraceData> traceDataList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));
                System.out.println("processing " + userId + "-----courseid:" + courseId + "----------trace size:" + traceDataList.size());
                Map<String, String> pageReadingReReadingMap = new HashMap<>();
                for (int k = 0; k < traceDataList.size(); k++) {
                    TraceData t = traceDataList.get(k);
                    if (k == 0) {
                        currentUrl = t.getUrl();
                    }
                    // 1. fix TRY_OUT_TOOLS
                    if ("TRY_OUT_TOOLS".equals(t.getSubActionLabel())) {
                        String tempSubActionLabel = "";
                        String tempActionLabel = "";
                        switch (t.getSource()) {
                            case "ANNOTATION":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "READ_ANNOTATION";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_ANNOTATION";
                                }
                                tempActionLabel = "ANNOTATION";
                                break;
                            case "SEARCH_ANNOTATION":
                                tempSubActionLabel = "SEARCH_ANNOTATION";
                                tempActionLabel = "SEARCH_ANNOTATION";
                                break;
                            case "ESSAY":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_ESSAY";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_ESSAY";
                                }
                                tempActionLabel = "ESSAY";
                                break;
                            case "PLANNER":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_PLANNER";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_PLANNER";
                                }
                                tempActionLabel = "PLANNER";
                                break;
                            case "TIMER":
                                tempSubActionLabel = "TIMER";
                                tempActionLabel = "TIMER";
                                break;
                            case "CHATGPT":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_GPT";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_GPT";
                                }
                                tempActionLabel = "CHATGPT";
                                break;
                            case "CHATGPT_SCAFFOLD":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_GPT_SCAFFOLD";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_GPT_SCAFFOLD";
                                }
                                tempActionLabel = "CHATGPT_SCAFFOLD";
                                break;
                            case "DICTIONARY":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_DICTIONARY";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_DICTIONARY";
                                }
                                tempActionLabel = "DICTIONARY";
                                break;
                            case "CHATGPT_ASSISTANT_TEACHER":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_GPT_ASSISTANT_TEACHER";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_GPT_ASSISTANT_TEACHER";
                                }
                                tempActionLabel = "CHATGPT_ASSISTANT_TEACHER";
                                break;
                            case "CHATGPT_ASSESSMENT":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_GPT_ASSESSMENT";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_GPT_ASSESSMENT";
                                }
                                tempActionLabel = "CHATGPT_ASSESSMENT";
                                break;
                            case "CHATGPT_ASSISTANT":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_GPT_ASSISTANT";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_GPT_ASSISTANT";
                                }
                                tempActionLabel = "CHATGPT_ASSISTANT";
                                break;
                            case "ESSAY_PRODUCT":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_ESSAY_PRODUCT";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_ESSAY_PRODUCT";
                                }
                                tempActionLabel = "ESSAY_PRODUCT";
                                break;
                            case "PROCESS_VISUAL":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_PROCESS_VISUAL";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_PROCESS_VISUAL";
                                }
                                tempActionLabel = "PROCESS_VISUAL";
                                break;
                            case "CHECKLIST":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_CHECKLIST";
                                } else if ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_CHECKLIST";
                                }
                                tempActionLabel = "CHECKLIST";
                                break;
                            case "CHATGPT_MULTI_AGENTS_SINGLE_WINDOW":
                                if ("OPEN".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "OPEN_CHATGPT_MULTI_AGENTS_SINGLE_WINDOW";
                                } else if  ("CLOSE".equals(t.getInstantEvent())) {
                                    tempSubActionLabel = "CLOSE_CHATGPT_MULTI_AGENTS_SINGLE_WINDOW";
                                }
                                tempActionLabel = "CHATGPT_MULTI_AGENTS_SINGLE_WINDOW";
                                break;
                            default:
                                throw new RuntimeException("Exception in switch: subactionlabel:" + t.getSubActionLabel() + "------" + t.getSource());
                        }
                        if (StrUtil.isEmpty(tempSubActionLabel) || StrUtil.isEmpty(tempActionLabel)) {
                            System.out.println(t);
                            throw new RuntimeException("Exception fix TRY_OUT_TOOLS exception");
                        }
                        t.setSubActionLabel(tempSubActionLabel);
                        t.setActionLabel(tempActionLabel);
                        needUpdateTraceList.add(t);
                    }

                    // end--------------------------------------- fix TRY_OUT_TOOLS
                    // 2. fix NOT_USE
                    // 3. fix BODY
                    // 4. fix xxxxxxxxxxx
                    // 5. fix INSTRUCTION_READING/INSTRUCTION_REREADING
                    // 6. fix REREADING/READING
//                    MyMoodleConfigConstant.IRRELEVANT_READING_PAGE_ID_SET.addAll(Set.of(
//                            "288", "290", "297", "299", "302", "307", "309", "316", "318", "321",
//                            "326", "328", "335", "337", "340", "185", "187", "194", "196", "199",
//                            "405", "407", "414", "416", "419", "250", "252", "259", "261", "264"));
                    if (t.getSubActionLabel() == null) {
                        t.setSubActionLabel(t.getSource());
                        t.setActionLabel(t.getSource());
                    }

                    if (t.getSubActionLabel() != null && Set.of("NOT_USE", "BODY", "xxxxxxxxxxx", "INSTRUCTION_READING", "INSTRUCTION_REREADING", "REREADING", "READING", "RELEVANT_READING", "RELEVANT_REREADING").contains(t.getSubActionLabel())) {
                        String urlRelevantOrNot = iTraceDataService.checkUrlRelevant(t.getUrl());
                        String actionLabel = urlRelevantOrNot.split(":::")[0];
                        String subActionLabel = urlRelevantOrNot.split(":::")[1];


                        if ("INSTRUCTION".equals(actionLabel)) {
                            t.setSubActionLabel(subActionLabel);
                        } else { // 此处可以解决页面是否是re reading or first time reading
                            if (pageReadingReReadingMap.containsKey(t.getUrl())) { // re-reading
                                t.setSubActionLabel(subActionLabel + "_REREADING");
                            } else { // first time reading
                                t.setSubActionLabel(subActionLabel + "_READING");
                            }
                        }

                        t.setActionLabel(actionLabel);

                        needUpdateTraceList.add(t);
                    }

                    if (t.getSource().equals("PAGE") && t.getInstantEvent().startsWith("CHANGE_PAGE_CLICK")) {

                        pageReadingReReadingMap.put(t.getUrl(), "1");
                    }
                    if (t.getSource().equals("PAGE") && t.getInstantEvent().equals("LEAVE_PAGE")) {

                        TraceData preTrace = traceDataList.get(k - 1);
                        if (preTrace.getInstantEvent().startsWith("CHANGE_PAGE_CLICK")) {
                            t.setSubActionLabel(preTrace.getSubActionLabel());
                            t.setActionLabel(preTrace.getActionLabel());
                        } else {
//                            throw new RuntimeException("no CHANGE_PAGE_CLICK before LEAVE_PAGE");
                            pageReadingReReadingMap.put(t.getUrl(), "1");
                        }
                        needUpdateTraceList.add(t);
                    }
                }

                System.out.println("--------user id:" + userId + "-----courseid:" + courseId + "-----needUpdateTraceList:" + needUpdateTraceList.size());

                if (!needUpdateTraceList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdateTraceList);
                }
            }
        }
    }

    @Autowired
    private ThreadPoolTaskExecutor asyncPoolTaskExecutor;

    /**
     * step 1 可以自动执行修复
     * 多线程执行
     */
    @Test
    public void fixHasCloseButNoOpenLogIssue() {

        Instant start = Instant.now();
        /*for (int i = 0; i < beijingUserCourseId.length; i++) {
            int userId = beijingUserCourseId[i][0];
            int courseId = beijingUserCourseId[i][1];*/
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];
//            if (i % count == 0 && i != 0) {
//                try {
//                    System.out.println("start to sleep i=" + i + " -----------------------------");
//                    Thread.sleep(200000L);
//                    System.out.println("sleep finish...........................");
//                } catch (Exception e) {
//                    e.printStackTrace();
//                }
//            }
                actionAndProcessService.fixHasCloseButNoOpenLogIssue(userId, courseId);
            }
        }
        Instant end = Instant.now();
        Duration duration = Duration.between(start, end);
        System.out.println(duration.toSeconds());

        try {
            System.out.println("everything finish-----------------------------");
            Thread.sleep( 30000L);
            System.out.println("sleep finish...........................");
        } catch (Exception e) {
            e.printStackTrace();
        }

    }

    /**
     * step 2.1 需要手动修复, 手动找到位置，并添加相应的log, 因为没有close，但是有操作过tool
     * 手动找到开始使用的时间，手动创建这个log
     * OPEN planner
     * OPEN essay
     * OPEN search annotation
     */
    @Test
    public void findMissingOpenPlanner() {

        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                sb.append("processing " + userIdArray[i] + "-----courseid:" + courseIdArray[j] + "\n");
                List<TraceData> traceDataList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userIdArray[i], String.valueOf(courseIdArray[j]));
                TraceData tempMoveOnShowPlannerBtnTraceData = null;
                AtomicInteger countMissingOpen = new AtomicInteger();
                Map<TraceData, List<TraceData>> checkOpenMap = new HashMap<>();
                for (TraceData traceData: traceDataList) {

                    if ("BUTTON#showPlanner2Btn".equals(traceData.getTargetObject())) {
                        tempMoveOnShowPlannerBtnTraceData = traceData;
                        checkOpenMap.put(traceData, new ArrayList<>());
                    } else if (tempMoveOnShowPlannerBtnTraceData != null && Long.parseLong(traceData.getSaveTime()) - Long.parseLong(tempMoveOnShowPlannerBtnTraceData.getSaveTime()) < 2000) {
                        checkOpenMap.get(tempMoveOnShowPlannerBtnTraceData).add(traceData);
                    }
                }

                checkOpenMap.forEach((traceData, traceDataList1) -> {
                    if (CollUtil.isEmpty(traceDataList1)) {
                        return;
                    }
                    boolean noOpen = true;
                    for (TraceData t : traceDataList1) {
                        if ("OPEN".equals(t.getInstantEvent())) {
                            noOpen = false;
                        }
                    }
                    if (noOpen) {
                        countMissingOpen.getAndIncrement();
                        sb.append("no open near this trace-------------------" + traceData + "\n");
                    }
                });
                sb.append("userid:" + userIdArray[i] + " has countMissingOpen:" + countMissingOpen + "\n");

            }
        }

        try (BufferedWriter writer = new BufferedWriter(new FileWriter("F:\\JavaProjects\\FLoRA_backend\\logs\\missing_open_output.txt"))) {
            writer.write(sb.toString());
            System.out.println("Data successfully written to the file.");
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    /**
     * step 2.2 需要手动修复, 手动找到位置，并添加相应的log, 因为没有close，但是有操作过tool
     * 手动找到开始使用的时间，手动创建这个log
     * OPEN planner
     * OPEN essay
     * OPEN search annotation
     */
    @Test
    public void manuallyCreateMissingOpenPlanner() {

//String actionLabel, String courseId, long userId, String saveTime, String username, String url, String firstname, String lastname, String source, String pageEvent, String targetObject, String instantEvent, String subActionLabel, String screenX, String screenY, String clientX, String clientY, String windowInnerWidth, String windowInnerHeight, String screenWidth, String screenHeight, String eventValue
        List<TraceData> traceDataList = new ArrayList<>();
        traceDataList.add(manuallyCreateOneTraceData("PLANNER", "76", 2746L, "1706199215210", "CELLA i8e01", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=523", "CELLA", "i8e01", "PLANNER", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "OPEN", "OPEN_PLANNER", "0", "0", "0", "0", "1920", "839", "1280", "720", "START_USE_TOOL:::1706199215210"));
        traceDataList.add(manuallyCreateOneTraceData("PLANNER", "65", 2691L, "1706204826700", "CELLA i7c01", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=404", "CELLA", "i7c01", "PLANNER", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "OPEN", "OPEN_PLANNER", "0", "0", "0", "0", "1536", "695", "1536", "864", "START_USE_TOOL:::1706204826700"));

//        traceDataList.add(manuallyCreateOneTraceData("PLANNER", "65", 2691L, "1706204826700", "CELLA i7c01", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=404", "CELLA", "i7c01", "PLANNER", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "OPEN", "OPEN_PLANNER", "0", "0", "0", "0", "1536", "695", "1536", "864", "START_USE_TOOL:::1706204826700"));




        iTraceDataService.saveBatch(traceDataList);
    }
    private TraceData manuallyCreateOneTraceData(String actionLabel, String courseId, long userId, String saveTime, String username, String url, String firstname, String lastname,
                                                 String source, String pageEvent, String targetObject, String instantEvent, String subActionLabel, String screenX, String screenY,
                                                 String clientX, String clientY, String windowInnerWidth, String windowInnerHeight, String screenWidth, String screenHeight, String eventValue) {
        TraceData manuallyCreatedTraceData = new TraceData();


        manuallyCreatedTraceData.setDetailedActionLabel(null);
        manuallyCreatedTraceData.setActionLabel(actionLabel);
        manuallyCreatedTraceData.setModelType(null);
        manuallyCreatedTraceData.setCourseId(courseId);
        manuallyCreatedTraceData.setProcessLabel(null);

        manuallyCreatedTraceData.setUserId(userId);
        manuallyCreatedTraceData.setSaveTime(saveTime);
        manuallyCreatedTraceData.setUsername(username);
        manuallyCreatedTraceData.setUrl(url);
        manuallyCreatedTraceData.setFirstname(firstname);
        manuallyCreatedTraceData.setLastname(lastname);
        manuallyCreatedTraceData.setSource(source);
        manuallyCreatedTraceData.setPageEvent(pageEvent);
        manuallyCreatedTraceData.setTargetObject(targetObject);
        manuallyCreatedTraceData.setInstantEvent(instantEvent);
        manuallyCreatedTraceData.setSubActionLabel(subActionLabel);
        manuallyCreatedTraceData.setScreenX(screenX);
        manuallyCreatedTraceData.setScreenY(screenY);
        manuallyCreatedTraceData.setClientX(clientX);
        manuallyCreatedTraceData.setClientY(clientY);
        manuallyCreatedTraceData.setWindowInnerWidth(windowInnerWidth);
        manuallyCreatedTraceData.setWindowInnerHeight(windowInnerHeight);
        manuallyCreatedTraceData.setScreenWidth(screenWidth);
        manuallyCreatedTraceData.setScreenHeight(screenHeight);
        manuallyCreatedTraceData.setEventValue(eventValue);
        return manuallyCreatedTraceData;
    }

    /**
     * step 3 自动执行
     */
    @Test
    public void fixEditNoteIssue() {

        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];

                System.out.println("processing " + userId + "-----courseid:" + courseId);

                List<TraceData> traceDataList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));

                List<TraceData> needUpdateTraceDataList = new ArrayList<>();

                for (TraceData traceData : traceDataList) {
                    if ("EDIT_NOTE_BTN".equals(traceData.getTargetObject())) {
                        traceData.setSubActionLabel("EDIT_ANNOTATION");

                    }
                    if ("SAVE_NOTES_BTN".equals(traceData.getTargetObject())) {
                        traceData.setSubActionLabel("EDIT_ANNOTATION");
                    }
                    needUpdateTraceDataList.add(traceData);
                }

                if (!needUpdateTraceDataList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdateTraceDataList);
                }
            }
        }
    }

    /**
     * step 4 自动执行
     */
    @Test
    public void fixMouseMoveOnToolsIssue() {
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];
                System.out.println("processing " + userId + "-----courseid:" + courseId);

                List<TraceData> traceDataList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));
                boolean plannerEditButtonClickStatus = false;
                boolean plannerSaveButtonClickStatus = false;
                boolean plannerOpenStatus = false;

                boolean searchAnnotationOpenStatus = false;

                boolean annotationOpenStatus = false;
                boolean annotationEditStatus = false;

                boolean essayOpenStatus = false;

                String currentUrl = "";
//                boolean urlChanged = false;
                List<TraceData> needUpdatePlannerTraceList = new ArrayList<>();
                List<TraceData> needUpdateEssayTraceList = new ArrayList<>();
                List<TraceData> needUpdateAnnotationTraceList = new ArrayList<>();
                List<TraceData> needUpdateSearchAnnotationTraceList = new ArrayList<>();


                for (TraceData traceData : traceDataList) {
                    if (StrUtil.isEmpty(currentUrl)) {
                        currentUrl = traceData.getUrl();
                    }
                    if (!currentUrl.equals(traceData.getUrl())) {
//                        urlChanged = true;
                        currentUrl = traceData.getUrl();
                        plannerOpenStatus = false;
                        plannerSaveButtonClickStatus = false;
                        plannerEditButtonClickStatus = false;

                        searchAnnotationOpenStatus = false;

                        annotationOpenStatus = false;
                        annotationEditStatus = false;

                        essayOpenStatus = false;
                    }
                    // 如果切换页面，open status 就要变成false， 等待下一次open


                    if ("OPEN_PLANNER".equals(traceData.getSubActionLabel())) {
                        plannerOpenStatus = true;
                    }
                    // 如果出现close event， open status 也变成 false
                    if ("CLOSE_PLANNER".equals(traceData.getSubActionLabel())) {
                        plannerOpenStatus = false;
                    }

                    if ("EDIT_PLANNER".equals(traceData.getSubActionLabel())) {
                        plannerEditButtonClickStatus = true;
                        plannerSaveButtonClickStatus = false;
                    }
                    if ("SAVE_PLANNER".equals(traceData.getSubActionLabel())) {
                        plannerSaveButtonClickStatus = true;
                        plannerEditButtonClickStatus = false;
                    }

                    if ("SEARCH_ANNOTATION".equals(traceData.getSubActionLabel()) && "OPEN".equals(traceData.getInstantEvent())) {
                        searchAnnotationOpenStatus = true;
                    }
                    if (("SEARCH_ANNOTATION".equals(traceData.getSubActionLabel()) || "CLOSE_SEARCH_ANNOTATION".equals(traceData.getSubActionLabel())) && "CLOSE".equals(traceData.getInstantEvent())) {
                        searchAnnotationOpenStatus = false;
                    }
                    if ("READ_ANNOTATION".equals(traceData.getSubActionLabel()) || "CREATE_NOTE".equals(traceData.getSubActionLabel())) {
                        annotationOpenStatus = true;
                    }
                    if ("CLOSE_ANNOTATION".equals(traceData.getSubActionLabel())) {
                        annotationOpenStatus = false;
                    }
                    if ("EDIT_NOTE_BTN".equals(traceData.getTargetObject())) {
                        annotationEditStatus = true;
                    }
                    if ("SAVE_NOTES_BTN".equals(traceData.getTargetObject())) {
                        annotationEditStatus = false;
                    }
                    if ("OPEN_ESSAY".equals(traceData.getSubActionLabel())) {
                        essayOpenStatus = true;
                    }
                    if ("CLOSE_ESSAY".equals(traceData.getSubActionLabel())) {
                        essayOpenStatus = false;
                    }

                    if (("MOUSE_MOVE".equals(traceData.getPageEvent()) || "MOUSE_WHEEL".equals(traceData.getPageEvent())) && (!traceData.getSubActionLabel().equals("TABLE_OF_CONTENT"))) {
                        try {
                            Integer clientX = Integer.parseInt(traceData.getClientX());
                            Integer clientY = Integer.parseInt(traceData.getClientY());
                            Integer windowInnerWidth = Integer.parseInt(traceData.getWindowInnerWidth());
                            Integer windowInnerHeight = Integer.parseInt(traceData.getWindowInnerHeight());


                            // 判定 在 planner上面移动
                            // 识别区域 height 90%    width = 28%   margin right 50px
                            // 起始标志
                            // Save 之前都是 create planner
                            // 点edit 之后 都是 edit planner


                            // 找到 SELECT#learning-strategy-select 之前的 最后一个 BUTTON#showPlanner2Btn
                            if (plannerOpenStatus) {
                                // 区域在planner 上， planner 也是打开状态
                                if (clientX > windowInnerWidth - windowInnerWidth * 0.28 - 50 && clientX < windowInnerWidth - 50 && clientY > windowInnerHeight - windowInnerHeight * 0.9) {
                                    String subActionLabel = "";
                                    if (plannerEditButtonClickStatus) {
                                        subActionLabel = "EDIT_PLANNER";
                                    } else if (plannerSaveButtonClickStatus) {
                                        subActionLabel = "READ_PLANNER";
                                    } else {
                                        subActionLabel = "CREATE_PLANNER";
                                    }
                                    traceData.setSubActionLabel(subActionLabel);
                                    traceData.setActionLabel("PLANNER");

                                    needUpdatePlannerTraceList.add(traceData);
                                }
                            }

                            // 判定在 annotation 上面移动
                            // 识别区域  height 100%  width  500px

                            // 起始标志

                            // 终止标志
                            if (annotationOpenStatus) {
                                if (clientX > windowInnerWidth - 500 - 50) {
                                    String subActionLabel = "READ_ANNOTATION";
                                    if (annotationEditStatus) {
                                        subActionLabel = "EDIT_ANNOTATION";
                                    }
                                    traceData.setSubActionLabel(subActionLabel);
                                    traceData.setActionLabel("ANNOTATION");
                                    needUpdateAnnotationTraceList.add(traceData);
                                }
                            }

                            // 判定在 search annotation 上面移动
                            // 识别区域   height 90%    width = 28%  margin right 50px

                            // 起始标志

                            // 终止标志
                            if (searchAnnotationOpenStatus) {
                                if (clientX > windowInnerWidth - windowInnerWidth * 0.28 - 50 && clientX < windowInnerWidth - 50 && clientY > windowInnerHeight - windowInnerHeight * 0.9) {
                                    traceData.setSubActionLabel("SEARCH_ANNOTATION");
                                    traceData.setActionLabel("SEARCH_ANNOTATION");

                                    needUpdateSearchAnnotationTraceList.add(traceData);
                                }
                            }


                            // 判定在 essay 上面移动
                            // 识别区域 判断essay 是否和 别东工具一起打开   height 60%    width = 50%   margin right 50px
                            // 其他工具打开时，essay  margin-right: 31%


                            // 起始标志

                            // 终止标志
                            if (essayOpenStatus) {
                                if (searchAnnotationOpenStatus || plannerOpenStatus) {
                                    if (clientX > windowInnerWidth - windowInnerWidth * 0.5 - windowInnerWidth * 0.31 && clientX < windowInnerWidth - windowInnerWidth * 0.31 && clientY > windowInnerHeight - windowInnerHeight * 0.6) {
                                        traceData.setSubActionLabel("READ_ESSAY");
                                        traceData.setActionLabel("ESSAY");
                                        needUpdateEssayTraceList.add(traceData);
                                    }
                                } else if (clientX > windowInnerWidth - windowInnerWidth * 0.5 - 50 && clientX < windowInnerWidth - 50 && clientY > windowInnerHeight - windowInnerHeight * 0.6) {
                                    traceData.setSubActionLabel("READ_ESSAY");
                                    traceData.setActionLabel("ESSAY");
                                    needUpdateEssayTraceList.add(traceData);
                                }
                            }

                        } catch (NumberFormatException numberFormatException) {
                            System.out.println("NumberFormatException:---------------" + traceData.toString());
                        }
                    }
                }

                if (!needUpdatePlannerTraceList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdatePlannerTraceList);
                }
                if (!needUpdateEssayTraceList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdateEssayTraceList);
                }
                if (!needUpdateAnnotationTraceList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdateAnnotationTraceList);
                }
                if (!needUpdateSearchAnnotationTraceList.isEmpty()) {
                    iTraceDataService.updateBatchById(needUpdateSearchAnnotationTraceList);
                }
            }
        }

    }

    /**
     * Step 5 option 1: generate process label 自动执行
     */
    @Test
    public void testDataReProcessing() {
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];
                System.out.println("processing " + userId + "-----courseid:" + courseId);
//                actionAndProcessService.labelAllProcessLabelPatternsWithoutMouseData((long) userId, String.valueOf(courseId), "maria");
                actionAndProcessService.labelAllProcessLabelPatterns((long) userId, String.valueOf(courseId), "maria");
            }
        }
    }

    /**
     * Step 5 option 2: remove all mouse move(Reading part) and generate process label 自动执行
     */
    @Test
    public void testRemoveMouseMoveOulu() {
        for (int i = 0; i < userIdArray.length; i++) {
            for (int j = 0; j < courseIdArray.length; j++) {
                int userId = userIdArray[i];
                int courseId = courseIdArray[j];
                removeMouseMove(userId, courseId, "maria");
                // 当处理过一遍之后，直接可以跑 另一个模型
//                actionAndProcessService.labelAllProcessLabelPatterns((long) userId, String.valueOf(courseId), "copes");
            }
        }
    }



    @Test
    public void testRemoveMouseMoveOuluMultiThread() throws InterruptedException {

        // 定义自定义的 Runnable，实现参数传递
        class ParameterizedTask implements Runnable {
//            private int[] userIdArray1;
//            private int[] courseIdArray1;
            private int[][] userCourseIdArray;

            public ParameterizedTask(int[][] userCourseIdArray) {
                this.userCourseIdArray = userCourseIdArray;
            }

            @Override
            public void run() {
                String threadName = Thread.currentThread().getName();
                System.out.println("线程：" + threadName + " 正在执行任务，使用 ");
                for (int i = 0; i < this.userCourseIdArray.length; i++) {
                    int userId = this.userCourseIdArray[i][0];
                    int courseId = this.userCourseIdArray[i][1];
                        // 执行函数逻辑，使用 variable
//                        removeMouseMove(userId, courseId, "maria");
//                        actionAndProcessService.labelAllProcessLabelPatterns((long) userId, String.valueOf(courseId), "copes");
                    //1. 清除所有process label 设置为null
                    iTraceDataService.updateProcessLabelToNullByUserIdCourseId((long) userId, String.valueOf(courseId));
                    actionAndProcessService.labelAllProcessLabelPatterns((long) userId, String.valueOf(courseId), "maria");
                }
                System.out.println("线程：" + threadName + " 执行完毕");
            }
        }

        /*int[][] userCourseIdArray1 = new int[][]{{168,8}, {169,8}, {170,8}, {171,8}, {172,8}, {173,8}, {174,8}, {175,8}, {178,8}, {179,8}, {180,8}, {181,8}, {182,8}, {183,8}, {184,8},
                {185,8}, {186,8}, {187,8}, {188,8}, {189,8}, {190,8}, {191,8}, {192,8}, {196,8}, {200,8}, {201,8}, {202,8}, {204,8}, {205,8}, {206,8},
                {207,8}, {208,8}, {209,8}, {218,9}, {219,9}, {220,9}, {221,9}, {223,9}, {225,9}, {228,9}, {229,9}, {230,9}, {231,9}, {232,9}, {233,9},
        };
        int[][] userCourseIdArray2 = new int[][]{
                {234,9}, {235,9}, {236,9}, {237,9}, {238,9}, {239,9}, {240,9}, {241,9}, {242,9}, {250,9}, {251,9}, {252,9}, {253,9}, {254,9}, {255,9},
                {256,9}, {257,9}, {258,9}, {259,9}, {267,9}, {268,10}, {271,10}, {272,10}, {273,10}, {274,10}, {275,10}, {276,10}, {277,10}, {278,10},
                {279,10}, {280,10}, {281,10}, {282,10}, {284,10}, {286,10}, {288,10}, {289,10}, {290,10}, {291,10}, {292,10}, {293,10}, {294,10}, {295,10}, {296,10},
                };
        int[][] userCourseIdArray3 = new int[][]{
                {297,10}, {298,10}, {299,10}, {300,10}, {301,10}, {302,10}, {315,10}, {316,10}, {318,5}, {319,5}, {320,5}, {321,5}, {322,5}, {323,5}, {324,5}, {325,5},
                {326,5}, {327,5}, {328,5}, {329,5}, {330,5}, {331,5}, {332,5}, {334,5}, {335,5}, {336,5}, {337,5}, {338,5}, {339,5}, {340,5}, {341,5}, {342,5}, {343,5},
                {344,5}, {345,5}, {346,5}, {347,5}, {348,5}, {349,5}, {350,5}, {351,5}, {352,5}, {353,5}, {354,5}, {356,5}, {358,5}, {360,5}, {361,5}, {362,5}, {363,5},
                {365,5}, {366,5}, {367,5}, {368,5}, {369,5}, {370,5}, {371,5}, {372,5}, {373,5}, {374,5}, {375,5}, {376,5}, {379,5}, {380,5}, {381,5}, {382,5}, {383,5},
        };
        int[][] userCourseIdArray4 = new int[][]{
                {384,5}, {385,5}, {386,5}, {387,5}, {388,5}, {389,5}, {390,5}, {391,5}, {392,5}, {393,5}, {394,5}, {396,5}, {397,5}, {398,5}, {399,5}, {400,5}, {401,5},
                {402,5}, {405,5}, {408,5}, {409,5}, {410,5}, {411,5}, {412,5}, {413,5}, {414,5}, {415,5}, {416,5}, {417,5}, {418,5}, {419,5}, {420,5}, {421,5}, {422,5},
                {423,5}, {424,5}, {471,15}, {472,15}, {474,15}, {476,15}, {477,15}, {478,15}, {481,15}, {482,15}, {483,15}, {486,15}, {488,15}, {489,15}, {490,15}, {492,15},
                {494,15}, {495,15}, {496,15}, {497,15}, {498,15}, {499,15}, {503,15}, {518,16}, {519,16}, {521,16}, {523,16}, {524,16}, {525,16}, {528,16}, {533,16},
        };
        int[][] userCourseIdArray5 = new int[][]{
                {536,16}, {537,16}, {538,16}, {539,16}, {543,16}, {544,16}, {545,16}, {546,16}, {547,16}, {549,16}, {551,16}, {552,16}, {553,16}, {571,17}, {573,17},
                {574,17}, {575,17}, {576,17}, {581,17}, {585,17}, {588,17}, {593,17}, {594,17}, {595,17}, {597,17}, {598,17}, {601,17}, {858,15}, {860,15}, {861,15},
                {862,15}, {864,15}, {865,15}, {866,15}, {867,15}, {868,15}, {869,15}, {870,15}, {878,16}, {879,16}, {880,16}, {882,16}, {883,16}, {884,16}, {885,16},
                {887,16}, {888,16}, {889,16}, {890,16}, {898,17}, {899,17}, {900,17}, {901,17}, {902,17}, {903,17}, {904,17}, {905,17}, {906,17}, {907,17}, {910,17}
        };*/

        int[][] userCourseIdArray1 = new int[][]{{594,10}, {601,10}, {605,10}, {608,10}, {609,10}, {610,10}, {614,10}, {617,10}, {619,10}, {621,10}, {622,10}, {626,11}, {627,11}, {628,11}, {630,11}, {631,11}, {633,11}, {635,11}, {638,11}, {640,11}, {643,11}, {648,11}, {649,11}, {650,11}, {651,11}, {655,11}, {657,11}, {658,11}, {660,12}, {662,12}, {663,12}, {664,12}, {672,12}, {675,12}, {676,12}, {678,12}, {682,12}, {688,12}, {793,10}, {794,10}, {795,10}, {796,10}, {798,10}, {801,10}, {802,10}, {808,10}, {809,10}, {811,10}, {814,10}, {818,10}, {819,10}, {820,10}, {821,10}, {822,10}, {823,10}, {824,10}, {825,10}, {826,11}, {827,11}, {828,11}, {831,11}, {833,11}};
        int[][] userCourseIdArray2 = new int[][]{{834,11}, {835,11}, {838,11}, {839,11}, {845,11}, {851,11}, {854,11}, {856,11}, {857,11}, {859,12}, {860,12}, {861,12}, {862,12}, {863,12}, {864,12}, {867,12}, {869,12}, {872,12}, {876,12}, {877,12}, {878,12}, {882,12}, {888,12}, {889,12}, {890,12}, {891,12}, {892,12}, {893,10}, {894,10}, {902,10}, {903,10}, {905,10}, {907,10}, {908,10}, {909,10}, {910,10}, {912,10}, {913,10}, {915,10}, {917,10}, {927,11}, {933,11}, {934,11}, {938,11}, {939,11}, {941,11}, {943,11}, {944,11}, {945,11}, {947,11}, {948,11}, {958,11}, {967,12}, {972,12}, {976,12}, {977,12}, {979,12}, {983,12}, {984,12}, {985,12}, {986,12}, {987,12}};
        int[][] userCourseIdArray3 = new int[][]{{989,12}, {990,12}, {991,12}, {993,10}, {994,10}, {995,10}, {998,10}, {999,10}, {1000,10}, {1003,10}, {1006,10}, {1017,10}, {1025,10}, {1037,11}, {1038,11}, {1043,11}, {1044,11}, {1046,11}, {1047,11}, {1056,11}, {1058,11}, {1078,12}, {1079,12}, {1080,12}, {1081,12}, {1090,12}, {1695,20}, {1696,21}, {1697,20}, {1698,20}, {1699,4}, {1700,4}, {1701,20}, {1702,20}, {1703,4}, {1704,4}, {1705,21}, {1706,21}, {1707,4}, {1708,4}, {1709,20}, {1710,21}, {1711,4}, {1712,4}, {1713,20}, {1714,20}, {1715,4}, {1716,20}, {1717,20}, {1718,21}, {1719,20}, {1720,4}, {1721,4}, {1722,20}, {1723,21}, {1724,21}, {1727,4}, {1728,21}, {1729,21}, {1730,21}, {1735,21}, {1741,21}, {1812,4}, {2070,20}, {2071,20}, {2072,20}, {2073,20}, {2074,20}, {2075,20}, {2076,20}, {2077,20}, {2078,20}, {2079,20}, {2080,20}};
        int[][] userCourseIdArray4 = new int[][]{{2081,20}, {2115,21}, {2116,21}, {2117,21}, {2118,21}, {2119,21}, {2120,21}, {2121,21}, {2122,21}, {2123,21}, {2124,21}, {2126,21}, {2170,4}, {2171,4}, {2172,4}, {2173,4}, {2174,4}, {2175,4}, {2176,4}, {2177,4}, {2178,4}, {2180,4}, {2181,4}, {2182,4}, {2525,20}, {2526,20}, {2527,20}, {2528,20}, {2529,20}, {2530,20}, {2531,20}, {2532,20}, {2533,20}, {2534,20}, {2535,20}, {2536,20}, {2555,21}, {2556,21}, {2557,21}, {2558,21}, {2559,21}, {2560,21}, {2561,21}, {2562,21}, {2563,21}, {2564,21}, {2565,21}, {2566,21}, {2585,4}, {2586,4}, {2587,4}, {2588,4}, {2589,4}, {2590,4}, {2591,4}, {2592,4}, {2593,4}, {2594,4}, {2595,4}, {2596,4}, {2597,4}, {2615,20}, {2616,20}, {2617,20}, {2618,20}, {2619,20}, {2620,20}, {2621,20}, {2622,20}, {2645,21}, {2646,21}, {2647,21}, {2648,21}, {2649,21}, {2650,21}};
        int[][] userCourseIdArray5 = new int[][]{{2651,21}, {2652,21}, {2675,4}, {2676,4}, {2677,4}, {2678,4}, {2679,4}, {2680,4}, {2681,4}, {2682,4}, {2707,20}, {2710,20}, {2711,20}, {2712,20}, {2724,21}, {2725,21}, {2726,21}, {2727,21}, {2728,21}, {2729,21}, {2739,4}, {2740,4}, {2741,4}, {2742,4}, {2743,4}, {2744,4}, {4753,20}, {4754,20}, {4755,20}, {4756,20}, {4757,20}, {4758,20}, {4759,20}, {4766,20}, {4767,20}, {4768,20}, {4769,20}, {4770,20}, {4778,21}, {4779,21}, {4780,21}, {4781,21}, {4782,21}, {4783,21}, {4784,21}, {4791,21}, {4792,21}, {4793,21}, {4794,21}, {4803,4}, {4804,4}, {4805,4}, {4806,4}, {4807,4}, {4808,4}, {4809,4}, {4810,4}, {4817,4}, {4818,4}, {4819,4}, {4820,4}, {4821,4}, {4823,4}};
        // 创建三个任务，分别使用不同的变量
        Runnable task1 = new ParameterizedTask(userCourseIdArray1);
        Runnable task2 = new ParameterizedTask(userCourseIdArray2);
        Runnable task3 = new ParameterizedTask(userCourseIdArray3);
        Runnable task4 = new ParameterizedTask(userCourseIdArray4);
        Runnable task5 = new ParameterizedTask(userCourseIdArray5);


        // 创建线程，指定任务和名称
        Thread thread1 = new Thread(task1, "Thread-1");
        Thread thread2 = new Thread(task2, "Thread-2");
        Thread thread3 = new Thread(task3, "Thread-3");
        Thread thread4 = new Thread(task4, "Thread-4");
        Thread thread5 = new Thread(task5, "Thread-5");

        // 启动线程
        thread1.start();
        thread2.start();
        thread3.start();
        thread4.start();
        thread5.start();

        // 等待线程完成
        thread1.join();
        thread2.join();
        thread3.join();
        thread4.join();
        thread5.join();

        System.out.println("finish all------------------------");
    }

    private void removeMouseMove(int userId, int courseId, String modelType) {
        System.out.println("processing " + userId + "-----courseid:" + courseId);

        //1. 清除所有process label 设置为null
        iTraceDataService.updateProcessLabelToNullByUserIdCourseId((long) userId, String.valueOf(courseId));

        //2. update all CLOSE_SEARCH_ANNOTATION to SEARCH_ANNOTATION
        iTraceDataService.updateCloseSearchAnnotationByUserIdCourseId((long) userId, String.valueOf(courseId));

        //3. delete  leave page 之后有多条 从前一个页面带过来的 trace
        List<Long> needDeleteTraceAfterLeavePageIdList = new ArrayList<>();
        List<TraceData> traceDataForLeavePageList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));
        boolean monitorStatus = false;
        TraceData leavePageTrace = null;
        for (int k = 0; k < traceDataForLeavePageList.size(); k++) {
            TraceData traceData = traceDataForLeavePageList.get(k);

            if ("LEAVE_PAGE".equals(traceData.getInstantEvent())) {
                monitorStatus = true;
                leavePageTrace = traceData;
            } else {
                if (Set.of("MOUSE_MOVE", "MOUSE_WHEEL").contains(traceData.getPageEvent())) {
                    if (leavePageTrace != null) {
                        if (traceData.getUrl().equals(leavePageTrace.getUrl())) {
                            needDeleteTraceAfterLeavePageIdList.add(traceData.getId());
                        } else {
                            leavePageTrace = null;
                        }
                    }
                }
            }
        }
        System.out.println("needDeleteTraceAfterLeavePageIdList size:" + needDeleteTraceAfterLeavePageIdList.size());
        if (!needDeleteTraceAfterLeavePageIdList.isEmpty()) {
            iTraceDataService.removeByIds(needDeleteTraceAfterLeavePageIdList);
        }

        // find all trace data
        List<TraceData> traceDataList = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));

        String tempCurrentPageUrl = "";

        //fix BODY_CLICK_READING issue
        List<TraceData> needUpdateBodyClickReadingList = new ArrayList<>();


        // fix leave page
        List<TraceData> needUpdateLeavePageList = new ArrayList<>();
        int countNeedFix = 0;
        for (int k = 0; k < traceDataList.size(); k++) {
            TraceData traceData = traceDataList.get(k);

            if (k == 0) {
                tempCurrentPageUrl = traceData.getUrl();
            }

            // change page url, change to other pages
            if (!tempCurrentPageUrl.equals(traceData.getUrl())) {
                System.out.println("k=" + k);
                TraceData lastPageLeavePageLog = traceDataList.get(k - 1);
                if (lastPageLeavePageLog == null) {
                    throw new RuntimeException("lastPageLeavePageLog null, k = " + k + ", userId: " + traceData.getUserId() + ",courseId:" + traceData.getCourseId() + ", itemId:" + traceData.getId());
                }

                if (!"LEAVE_PAGE".equals(lastPageLeavePageLog.getInstantEvent())) {
                    //需要手动创建 Leave page log
                    if ("CHANGE_PAGE_CLICK_READING".equals(lastPageLeavePageLog.getInstantEvent()) || "CHANGE_PAGE_CLICK_PAGE_NAVIGATION".equals(lastPageLeavePageLog.getInstantEvent())) {
                        TraceData manuallyCreatedLeavePageTraceData = createLeavePageTraceData(lastPageLeavePageLog);
                        needUpdateLeavePageList.add(manuallyCreatedLeavePageTraceData);
                    } else {
                        // 需要手动修复
                        countNeedFix++;
                        System.out.println("cannot find CHANGE_PAGE_CLICK_READING and LEAVE_PAGE, k = " + k + ", userId: " + traceData.getUserId() + ",courseId:" + traceData.getCourseId() + ", itemId:" + traceData.getId());
//                                throw new RuntimeException("cannot find CHANGE_PAGE_CLICK_READING and LEAVE_PAGE, k = " + k + ", userId: " + traceData.getUserId() + ",courseId:" + traceData.getCourseId() + ", itemId:" + traceData.getId());
                    }
                }
                tempCurrentPageUrl = traceData.getUrl(); // 更新当前页面url
            }

            // 修复单独的BODY_CLICK_READING 错误
            if (traceData.getInstantEvent().equals("BODY_CLICK_READING")) {
                if (k - 1 >= 0 && traceDataList.get(k - 1).getSubActionLabel().equals("TABLE_OF_CONTENT") &&
                        traceDataList.size() > k + 1 &&
                        traceDataList.get(k + 1).getSubActionLabel().equals("TABLE_OF_CONTENT")) {
                    traceData.setSubActionLabel("TABLE_OF_CONTENT");
                    traceData.setActionLabel("NAVIGATION");
                    needUpdateBodyClickReadingList.add(traceData);
                }
            }
        }
        if (countNeedFix != 0) {
            System.out.println("countNeedFix = " + countNeedFix);
//                    throw new RuntimeException("cannot find CHANGE_PAGE_CLICK_READING and LEAVE_PAGE");
        }

        System.out.println("needUpdateLeavePageList size:" + needUpdateLeavePageList.size());
        System.out.println("needUpdateBodyClickReadingList size:" + needUpdateBodyClickReadingList.size());

        if (!needUpdateLeavePageList.isEmpty()) {
            iTraceDataService.saveBatch(needUpdateLeavePageList);
        }
        if (!needUpdateBodyClickReadingList.isEmpty()) {
            iTraceDataService.updateBatchById(needUpdateBodyClickReadingList);
        }
        // delete mouse move (action label: reading / instruction)
        List<TraceData> traceDataList2 = iTraceDataService.findAllByUserIdAndCourseIdOrderByTimeAsc((long) userId, String.valueOf(courseId));
        List<Long> needDeleteTraceDataIdList = new ArrayList<>();
        for (int k = 0; k < traceDataList2.size(); k++) {
            TraceData traceData = traceDataList2.get(k);

            // 删除 mouse move 的 TABLE_OF_CONTENT
            if (traceData.getPageEvent().equals("MOUSE_MOVE") && traceData.getSubActionLabel().equals("TABLE_OF_CONTENT")) {
                needDeleteTraceDataIdList.add(traceData.getId());
            }

            if (Set.of("MOUSE_MOVE", "MOUSE_WHEEL").contains(traceData.getPageEvent())
//                    && Set.of("TASK_REQUIREMENT", "RUBRIC", "RELEVANT_READING", "RELEVANT_REREADING").contains(traceData.getSubActionLabel())
            ) {

                // mouse 之前是 START_TASK
                if (k > 1 && traceDataList2.get(k - 1).getSubActionLabel().equals("START_TASK")) {
                    continue;
                }

                if (k == traceDataList2.size() - 1) {
                    continue;
                }

                /*
                if (k > 1 && ("TIMER".equals(traceDataList2.get(k - 1).getSource()) || "TIMER".equals(traceDataList2.get(k + 1).getSource())) &&
                        ("OPEN".equals(traceDataList2.get(k - 1).getInstantEvent()) || "OPEN".equals(traceDataList2.get(k + 1).getInstantEvent()))) {
                    continue;
                }

                // mouse 之前是close tool
                if (k > 1 && (
                        Set.of("CLOSE_ESSAY", "CLOSE_PLANNER", "CLOSE_ANNOTATION").contains(traceDataList2.get(k - 1).getSubActionLabel()) ||
                        (traceDataList2.get(k - 1).getInstantEvent().equals("CLOSE") && (traceDataList2.get(k - 1).getSubActionLabel().equals("SEARCH_ANNOTATION") || traceDataList2.get(k - 1).getSubActionLabel().equals("TRY_OUT_TOOLS"))))) {
                    continue;
                }

                // mouse 之后是open tool
                if (Set.of("OPEN_ESSAY", "OPEN_PLANNER", "OPEN_ANNOTATION", "CREATE_NOTE", "CREATE_HIGHLIGHT")
                        .contains(traceDataList2.get(k + 1).getSubActionLabel()) ||
                        (traceDataList2.get(k + 1).getInstantEvent().equals("OPEN") && (traceDataList2.get(k + 1).getSubActionLabel().equals("SEARCH_ANNOTATION") || traceDataList2.get(k + 1).getSubActionLabel().equals("TRY_OUT_TOOLS")))) {
                    continue;
                }*/

                // mouse 之前是leave page
                if (k > 1 && traceDataList2.get(k - 1).getInstantEvent().equals("LEAVE_PAGE")) {
                    continue;
                }

                // mouse 之后是leave page
                if (traceDataList2.get(k + 1).getInstantEvent().equals("LEAVE_PAGE")) {
                    continue;
                }

                needDeleteTraceDataIdList.add(traceData.getId());
            }
        }

        System.out.println("needDeleteTraceDataIdList size:" + needDeleteTraceDataIdList.size());
        if (!needDeleteTraceDataIdList.isEmpty()) {
            iTraceDataService.removeByIds(needDeleteTraceDataIdList);
        }

        // 查询所有open close event,
//                addTryOutTools(userId, courseId);

        //label process
        actionAndProcessService.labelAllProcessLabelPatterns((long) userId, String.valueOf(courseId), modelType);

    }

    private void addTryOutTools(int userId, int courseId) {
        List<TraceData> allOpenCloseTraceDataList = iTraceDataService.findAllOpenCloseTraceDataByUserIdCourseId((long) userId, String.valueOf(courseId));
        Map<String, String> toolUsedMap = new HashMap<>();

        TraceData currentOpenEssayTool = null;
        TraceData currentOpenPlannerTool = null;
        TraceData currentOpenAnnotationTool = null;
        TraceData currentOpenSearchAnnotationTool = null;

        List<TraceData> needUpdateOpenCloseToolsList = new ArrayList<>();
        for (int k = 0; k < allOpenCloseTraceDataList.size(); k++) {
            TraceData openCloseTrace = allOpenCloseTraceDataList.get(k);
            // 第一次打开并小于3秒 就是 try out tools
            if (openCloseTrace.getInstantEvent().equals("OPEN") && openCloseTrace.getSource().equals("TIMER")) {
                if (toolUsedMap.containsKey("TIMER")) {
                    continue;
                } else {
                    openCloseTrace.setSubActionLabel("TRY_OUT_TOOLS");
                    needUpdateOpenCloseToolsList.add(openCloseTrace);
                    toolUsedMap.put("TIMER", "used");
                }
            } else if (openCloseTrace.getInstantEvent().equals("OPEN") && openCloseTrace.getSource().equals("ESSAY")) {

                if (toolUsedMap.containsKey("CLOSE_ESSAY")) {
                    continue;
                }

                if (currentOpenEssayTool != null) { // 存在 只有OPEN essay，但是没有CLOSE essay 情况
                    toolUsedMap.put("CLOSE_ESSAY", "used"); // 表示已经使用过该工具
                    currentOpenEssayTool = null;
                } else {
                    currentOpenEssayTool = openCloseTrace; // 待查
                }
            } else if (openCloseTrace.getInstantEvent().equals("CLOSE") && openCloseTrace.getSource().equals("ESSAY")) {
                if (toolUsedMap.containsKey("CLOSE_ESSAY")) {
                    continue;
                } else {
                    int toolUseLength = Integer.parseInt(openCloseTrace.getEventValue().split(":::")[1]);
                    if (toolUseLength < 3000) {
                        currentOpenEssayTool.setSubActionLabel("TRY_OUT_TOOLS");
                        openCloseTrace.setSubActionLabel("TRY_OUT_TOOLS");
                        needUpdateOpenCloseToolsList.add(openCloseTrace);
                        needUpdateOpenCloseToolsList.add(currentOpenEssayTool);

                        System.out.println("-----------------------------");
                        System.out.println(currentOpenEssayTool);
                        System.out.println(openCloseTrace);
                        System.out.println("-----------------------------");
                        toolUsedMap.put("CLOSE_ESSAY", "used");
                    }
                    currentOpenEssayTool = null;
                }
            } else if (openCloseTrace.getInstantEvent().equals("OPEN") && openCloseTrace.getSource().equals("PLANNER")) {
                if (toolUsedMap.containsKey("CLOSE_PLANNER")) {
                    continue;
                }

                if (currentOpenPlannerTool != null) { // 存在 只有OPEN planner，但是没有CLOSE planner 情况
                    toolUsedMap.put("CLOSE_PLANNER", "used"); // 表示已经使用过该工具
                    currentOpenPlannerTool = null;
                } else {
                    currentOpenPlannerTool = openCloseTrace; // 待查
                }
            } else if (openCloseTrace.getInstantEvent().equals("CLOSE") && openCloseTrace.getSource().equals("PLANNER")) {
                if (toolUsedMap.containsKey("CLOSE_PLANNER")) {
                    continue;
                } else {
                    int toolUseLength = Integer.parseInt(openCloseTrace.getEventValue().split(":::")[1]);
                    if (toolUseLength < 3000) {
                        currentOpenPlannerTool.setSubActionLabel("TRY_OUT_TOOLS");
                        openCloseTrace.setSubActionLabel("TRY_OUT_TOOLS");
                        needUpdateOpenCloseToolsList.add(openCloseTrace);
                        needUpdateOpenCloseToolsList.add(currentOpenPlannerTool);

                        System.out.println("-----------------------------");
                        System.out.println(currentOpenPlannerTool);
                        System.out.println(openCloseTrace);
                        System.out.println("-----------------------------");
                        toolUsedMap.put("CLOSE_PLANNER", "used");
                    }
                    currentOpenPlannerTool = null;
                }
            } else if (openCloseTrace.getInstantEvent().equals("OPEN") && openCloseTrace.getSource().equals("ANNOTATION")) {
                if (toolUsedMap.containsKey("CLOSE_ANNOTATION")) {
                    continue;
                }
                if (currentOpenAnnotationTool != null) {
                    toolUsedMap.put("CLOSE_ANNOTATION", "used");
                    currentOpenAnnotationTool = null;
                } else {
                    currentOpenAnnotationTool = openCloseTrace;
                }
            } else if (openCloseTrace.getInstantEvent().equals("CLOSE") && openCloseTrace.getSource().equals("ANNOTATION")) {
                if (toolUsedMap.containsKey("CLOSE_ANNOTATION")) {
                    continue;
                } else {
                    int toolUseLength = Integer.parseInt(openCloseTrace.getEventValue().split(":::")[1]);
                    if (toolUseLength < 3000) {
                        currentOpenAnnotationTool.setSubActionLabel("TRY_OUT_TOOLS");
                        openCloseTrace.setSubActionLabel("TRY_OUT_TOOLS");
                        needUpdateOpenCloseToolsList.add(openCloseTrace);
                        needUpdateOpenCloseToolsList.add(currentOpenAnnotationTool);

                        System.out.println("-----------------------------");
                        System.out.println(currentOpenAnnotationTool);
                        System.out.println(openCloseTrace);
                        System.out.println("-----------------------------");
                        toolUsedMap.put("CLOSE_ANNOTATION", "used");
                    }
                    currentOpenAnnotationTool = null;
                }
            } else if (openCloseTrace.getInstantEvent().equals("OPEN") && openCloseTrace.getSource().equals("SEARCH_ANNOTATION")) {
                if (toolUsedMap.containsKey("CLOSE_SEARCH_ANNOTATION")) {
                    continue;
                }
                if (currentOpenSearchAnnotationTool != null) {
                    toolUsedMap.put("CLOSE_SEARCH_ANNOTATION", "used");
                    currentOpenSearchAnnotationTool = null;
                } else {
                    currentOpenSearchAnnotationTool = openCloseTrace;
                }
            } else if (openCloseTrace.getInstantEvent().equals("CLOSE") && openCloseTrace.getSource().equals("SEARCH_ANNOTATION")) {
                if (toolUsedMap.containsKey("CLOSE_SEARCH_ANNOTATION")) {
                    continue;
                } else {
                    int toolUseLength = Integer.parseInt(openCloseTrace.getEventValue().split(":::")[1]);
                    if (toolUseLength < 3000) {
                        currentOpenSearchAnnotationTool.setSubActionLabel("TRY_OUT_TOOLS");
                        openCloseTrace.setSubActionLabel("TRY_OUT_TOOLS");
                        needUpdateOpenCloseToolsList.add(openCloseTrace);
                        needUpdateOpenCloseToolsList.add(currentOpenSearchAnnotationTool);

                        System.out.println("-----------------------------");
                        System.out.println(currentOpenSearchAnnotationTool);
                        System.out.println(openCloseTrace);
                        System.out.println("-----------------------------");
                        toolUsedMap.put("CLOSE_SEARCH_ANNOTATION", "used");
                    }
                    currentOpenSearchAnnotationTool = null;
                }
            }
        }

        iTraceDataService.updateBatchById(needUpdateOpenCloseToolsList);
    }

    private TraceData createLeavePageTraceData(TraceData lastPageLeavePageLog) {


        long saveTime = Long.parseLong(lastPageLeavePageLog.getSaveTime()) + 1;

        TraceData manuallyCreatedTraceData = new TraceData();

        manuallyCreatedTraceData.setDetailedActionLabel(null);
        manuallyCreatedTraceData.setActionLabel(lastPageLeavePageLog.getActionLabel());
        manuallyCreatedTraceData.setModelType(null);
        manuallyCreatedTraceData.setCourseId(lastPageLeavePageLog.getCourseId());
        manuallyCreatedTraceData.setProcessLabel(null);

        manuallyCreatedTraceData.setUserId(lastPageLeavePageLog.getUserId());
        manuallyCreatedTraceData.setSaveTime(String.valueOf(saveTime));
        manuallyCreatedTraceData.setUsername(lastPageLeavePageLog.getUsername());
        manuallyCreatedTraceData.setUrl(lastPageLeavePageLog.getUrl());
        manuallyCreatedTraceData.setFirstname(lastPageLeavePageLog.getFirstname());
        manuallyCreatedTraceData.setLastname(lastPageLeavePageLog.getLastname());
        manuallyCreatedTraceData.setSource(lastPageLeavePageLog.getSource());
        manuallyCreatedTraceData.setPageEvent("MANUALLY_ADDED_DATA");
        manuallyCreatedTraceData.setTargetObject("NO_TARGET_OBJECT");
        manuallyCreatedTraceData.setInstantEvent("LEAVE_PAGE");
        manuallyCreatedTraceData.setSubActionLabel(lastPageLeavePageLog.getSubActionLabel());
        manuallyCreatedTraceData.setScreenX("0");
        manuallyCreatedTraceData.setScreenY("0");
        manuallyCreatedTraceData.setClientX("0");
        manuallyCreatedTraceData.setClientY("0");
        manuallyCreatedTraceData.setWindowInnerWidth(lastPageLeavePageLog.getWindowInnerWidth());
        manuallyCreatedTraceData.setWindowInnerHeight(lastPageLeavePageLog.getWindowInnerHeight());
        manuallyCreatedTraceData.setScreenWidth(lastPageLeavePageLog.getScreenWidth());
        manuallyCreatedTraceData.setScreenHeight(lastPageLeavePageLog.getScreenHeight());
        manuallyCreatedTraceData.setEventValue("");
        return manuallyCreatedTraceData;
    }



    /**
     *
     *
     *SELECT count(*)
     * FROM trace_data
     * WHERE save_time > '1704027600000' and
     *       NOT (
     *     (page_event = 'MOUSE_MOVE' OR page_event = 'MOUSE_WHEEL' or page_event = 'MOUSE_CLICK')
     *     AND (sub_action_label LIKE '%READING' OR sub_action_label = 'PAGE_NAVIGATION' OR  instant_event='BODY_CLICK_READING')
     * );  # number of item: 11311604
     *
     * select count(*) from trace_data WHERE save_time > '1704027600000'; # number of item: 25308384
     *
     *
     *
     */
//    @Test
//    public void testNijmegenRemoveMouseData() {
//        int[][] userIdCourseIdArray = {
//                {2312 , 40}, {2270 , 40}, {2271 , 40}, {2274 , 40}, {2280 , 40}, {2287 , 40}, {2275 , 40}, {2276 , 40}, {2268 , 40}, {2277 , 40}, {2293 , 40}, {2269 , 40}, {2288 , 40}, {2272 , 40}, {2281 , 40},
//                {2290 , 40}, {2289 , 40}, {2284 , 40}, {2265 , 40}, {2264 , 40}, {2266 , 40}, {2283 , 40}, {2278 , 40}, {2267 , 40}, {2294 , 40}, {2291 , 40}, {2292 , 40}, {2282 , 40}, {2002 , 65}, {1711 , 76},
//                {1711 , 64}, {1994 , 65}, {2000 , 65}, {2000 , 76}, {2000 , 64}, {2680 , 64}, {2682 , 64}, {2676 , 76}, {2001 , 76}, {2681 , 64}, {2680 , 65}, {2681 , 65}, {2682 , 65}, {2676 , 65}, {2001 , 65},
//                {1725 , 40}, {2003 , 76}, {2003 , 65}, {2311 , 40}, {2689 , 49}, {2002 , 76}, {2674 , 65}, {2675 , 65}, {2677 , 76}, {2677 , 65}, {2683 , 64}, {2683 , 65}, {2689 , 50}, {1999 , 76}, {1725 , 25},
//                {2678 , 76}, {2678 , 65}, {2679 , 76}, {2679 , 65}, {2685 , 64}, {2686 , 64}, {1711 , 65}, {2684 , 64}, {2685 , 65}, {2686 , 65}, {2674 , 76}, {2684 , 65}, {2746 , 76}, {2711 , 64}, {2746 , 65},
//                {2711 , 65}, {2691 , 64}, {2726 , 76}, {2691 , 65}, {2726 , 65}, {2303 , 40}, {2304 , 40}, {2714 , 64}, {2717 , 64}, {2712 , 64}, {2716 , 64}, {2715 , 64}, {2718 , 64}, {2719 , 64}, {2713 , 64},
//                {2748 , 76}, {2749 , 76}, {2754 , 76}, {2753 , 76}, {2752 , 76}, {2747 , 76}, {2750 , 76}, {2757 , 76}, {2756 , 76}, {2755 , 76}, {2751 , 76}, {2715 , 65}, {2716 , 65}, {2712 , 65}, {2718 , 65},
//                {2719 , 65}, {2714 , 65}, {2717 , 65}, {2713 , 65}, {2754 , 65}, {2752 , 65}, {2748 , 65}, {2753 , 65}, {2750 , 65}, {2747 , 65}, {2757 , 65}, {2755 , 65}, {2756 , 65}, {2749 , 65}, {2751 , 65},
//                {2502 , 25}, {2512 , 25}, {2504 , 25}, {2498 , 25}, {2506 , 25}, {2519 , 25}, {2511 , 25}, {2500 , 25}, {2499 , 25}, {2495 , 25}, {2503 , 25}, {2508 , 25}, {2516 , 25}, {2496 , 25}, {2501 , 25},
//                {2509 , 25}, {2520 , 25}, {2510 , 25}, {2507 , 25}, {2497 , 25}, {2494 , 25}, {2732 , 76}, {2693 , 64}, {2735 , 76}, {2697 , 64}, {2694 , 64}, {2695 , 64}, {2703 , 64}, {2692 , 64}, {2698 , 64},
//                {2700 , 64}, {2699 , 64}, {2701 , 64}, {2702 , 64}, {2696 , 64}, {2734 , 76}, {2727 , 76}, {2729 , 76}, {2739 , 76}, {2738 , 76}, {2728 , 76}, {2730 , 76}, {2733 , 76}, {2736 , 76}, {2737 , 76},
//                {2740 , 76}, {2731 , 76}, {2734 , 65}, {2740 , 65}, {2735 , 65}, {2738 , 65}, {2739 , 65}, {2733 , 65}, {2729 , 65}, {2730 , 65}, {2732 , 65}, {2736 , 65}, {2737 , 65}, {2727 , 65}, {2728 , 65},
//                {2731 , 65}, {2700 , 65}, {2693 , 65}, {2694 , 65}, {2696 , 65}, {2703 , 65}, {2695 , 65}, {2698 , 65}, {2692 , 65}, {2697 , 65}, {2699 , 65}, {2702 , 65}, {2701 , 65}, {2901 , 76}, {2871 , 64},
//                {2871 , 65}, {2901 , 65}, {2961 , 76}, {2931 , 64}, {2961 , 65}, {2931 , 65}, {2940 , 64}, {2967 , 76}, {2974 , 76}, {2968 , 76}, {2972 , 76}, {2976 , 76}, {2939 , 64}, {2964 , 76}, {2962 , 76},
//                {2970 , 76}, {2937 , 64}, {2934 , 64}, {2973 , 76}, {2975 , 76}, {2965 , 76}, {2938 , 64}, {2932 , 64}, {2933 , 64}, {2944 , 64}, {2963 , 76}, {2971 , 76}, {2936 , 64}, {2943 , 64}, {2969 , 76},
//                {2942 , 64}, {2941 , 64}, {2977 , 76}, {2945 , 64}, {2948 , 64}, {2946 , 64}, {2947 , 64}, {2964 , 65}, {2963 , 65}, {2934 , 65}, {2938 , 65}, {2948 , 65}, {2944 , 65}, {2942 , 65}, {2937 , 65},
//                {2933 , 65}, {2943 , 65}, {2932 , 65}, {2945 , 65}, {2940 , 65}, {2941 , 65}, {2939 , 65}, {2946 , 65}, {2936 , 65}, {2962 , 65}, {2974 , 65}, {2975 , 65}, {2977 , 65}, {2967 , 65}, {2969 , 65},
//                {2976 , 65}, {2965 , 65}, {2971 , 65}, {2972 , 65}, {2968 , 65}, {2973 , 65}, {2970 , 65}, {2947 , 65}, {2978 , 65}, {2979 , 65}, {2980 , 65}, {2981 , 65}, {2982 , 65}, {2983 , 65}, {2950 , 65},
//                {2949 , 65}, {2951 , 65}, {2952 , 65}, {2984 , 65}, {2953 , 65}, {2954 , 65}, {2986 , 65}, {2706 , 65}, {2707 , 65}, {2985 , 65}, {2987 , 65}, {2310 , 25}, {2310 , 40}, {2309 , 25}, {2988 , 76},
//                {2988 , 65}, {2885 , 64}, {2873 , 64}, {2876 , 64}, {2881 , 64}, {2877 , 64}, {2878 , 64}, {2882 , 64}, {2883 , 64}, {2911 , 76}, {2912 , 76}, {2872 , 64}, {2915 , 76}, {2875 , 64}, {2909 , 76},
//                {2913 , 76}, {2907 , 76}, {2906 , 76}, {2905 , 76}, {2919 , 76}, {2903 , 76}, {2874 , 64}, {2879 , 64}, {2908 , 76}, {2914 , 76}, {2916 , 76}, {2921 , 76}, {2923 , 76}, {2924 , 76}, {2917 , 76},
//                {2887 , 64}, {2876 , 65}, {2879 , 65}, {2877 , 65}, {2882 , 65}, {2883 , 65}, {2878 , 65}, {2881 , 65}, {2885 , 65}, {2873 , 65}, {2875 , 65}, {2872 , 65}, {2874 , 65}, {2880 , 65}, {2912 , 65},
//                {2915 , 65}, {2913 , 65}, {2906 , 65}, {2905 , 65}, {2921 , 65}, {2923 , 65}, {2903 , 65}, {2914 , 65}, {2911 , 65}, {2916 , 65}, {2909 , 65}, {2908 , 65}, {2907 , 65}, {2919 , 65}, {2924 , 65},
//                {2917 , 65}, {2887 , 65}, {13 , 49},   {1725 , 36}, {13 , 40},   {805 , 49},  {805 , 50},  {2309 , 40}, {2268 , 25}, {2508 , 40}, {2514 , 40}, {2499 , 40}, {2504 , 40}, {2505 , 40}, {2498 , 40},
//                {2502 , 40}, {2517 , 40}, {2506 , 40}, {2512 , 40}, {2511 , 40}, {2495 , 40}, {2510 , 40}, {2503 , 40}, {2516 , 40}, {2507 , 40}, {2515 , 40}, {2497 , 40}, {2509 , 40}, {2269 , 25}, {2578 , 25},
//                {2559 , 25}, {2570 , 25}, {2576 , 25}, {2571 , 25}, {2575 , 25}, {2561 , 25}, {2569 , 25}, {2567 , 25}, {2563 , 25}, {2577 , 25}, {2579 , 25}, {2573 , 25}, {2556 , 25}, {2554 , 25}, {2555 , 25},
//                {2557 , 25}, {2568 , 25}, {2558 , 25}, {2562 , 25}, {2565 , 25}, {2580 , 25}, {2564 , 25}, {809 , 49}, {2542 , 25}, {2538 , 25}, {2541 , 25}, {2537 , 25}, {2539 , 25}, {2533 , 25}, {2536 , 25},
//                {2532 , 25}, {2525 , 25}, {2545 , 25}, {2526 , 25}, {2540 , 25}, {2546 , 25}, {2534 , 25}, {2529 , 25}, {2528 , 25}, {2527 , 25}, {2530 , 25}, {2535 , 25}, {2524 , 25}, {2543 , 25}, {2531 , 25},
//                {2544 , 25}, {809 , 50}, {809 , 51}, {2306 , 25}, {2271 , 25}, {2305 , 25}, {2584 , 25}, {2606 , 25}, {2600 , 25}, {2599 , 25}, {2590 , 25}, {2608 , 25}, {2585 , 25}, {2592 , 25}, {2601 , 25},
//                {2591 , 25}, {2604 , 25}, {2594 , 25}, {2605 , 25}, {2610 , 25}, {2588 , 25}, {2598 , 25}, {2602 , 25}, {2607 , 25}, {2586 , 25}, {2587 , 25}, {2596 , 25}, {2611 , 25}, {2589 , 25}, {2612 , 25},
//                {2609 , 25}, {2572 , 25}, {2574 , 25}, {2566 , 25}, {2560 , 25}, {2595 , 25}, {2606 , 40}, {2612 , 40}, {2584 , 40}, {2607 , 40}, {2600 , 40}, {2608 , 40}, {2592 , 40}, {2585 , 40}, {2602 , 40},
//                {2591 , 40}, {2599 , 40}, {2590 , 40}, {2605 , 40}, {2595 , 40}, {2596 , 40}, {2601 , 40}, {2594 , 40}, {2587 , 40}, {2598 , 40}, {2589 , 40}, {2586 , 40}, {2611 , 40}, {2610 , 40}, {2609 , 40},
//                {2559 , 40}, {2568 , 40}, {2554 , 40}, {2570 , 40}, {2567 , 40}, {2578 , 40}, {2561 , 40}, {2572 , 40}, {2571 , 40}, {2563 , 40}, {2580 , 40}, {2562 , 40}, {2573 , 40}, {2574 , 40}, {2575 , 40},
//                {2557 , 40}, {2576 , 40}, {2577 , 40}, {2565 , 40}, {2569 , 40}, {2560 , 40}, {2556 , 40}, {2566 , 40}, {2558 , 40}, {2539 , 40}, {2541 , 40}, {2546 , 40}, {2537 , 40}, {2526 , 40}, {2529 , 40},
//                {2543 , 40}, {2542 , 40}, {2531 , 40}, {2540 , 40}, {2536 , 40}, {2524 , 40}, {2538 , 40}, {2528 , 40}, {2534 , 40}, {2533 , 40}, {2525 , 40}, {2530 , 40}, {2527 , 40}, {2535 , 40}, {2544 , 40},
//                {2604 , 40}, {2588 , 40}, {2545 , 40}, {2532 , 40}, {1711 , 84}};
//
//        for (int i = 0; i < userIdCourseIdArray.length; i++) {
//            int userId = userIdCourseIdArray[i][0];
//            int courseId = userIdCourseIdArray[i][1];
//            System.out.println("processing " + userId + "-----courseid:" + courseId);
//            actionAndProcessService.labelAllProcessLabelPatternsWithoutMouseData((long) userId, String.valueOf(courseId), "maria");
//        }
//    }

    @Test
    public void manuallyAddData() {
        List<TraceData> traceDataList = new ArrayList<>();
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "40", 2059L, "1699952747905", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=226", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "TASK_REQUIREMENT", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=227"));
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "40", 2059L, "1699952747906", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=226", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "TASK_REQUIREMENT", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::17997"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699952998532", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=229"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699952998533", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::142408"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953059298", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=229", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953059299", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=229", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::55897"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953550573", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=231"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953550575", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::124146"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953687874", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=231", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=232"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953687875", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=231", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::115267"));
//
//
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953926013", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=232", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=233"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699953926015", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=232", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::189579"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699954040343", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=233", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2059L, "1699954040345", "student56 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=233", "student56", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "950", "1024", "1366", "PAGE_STAY_TIME_LENGTH:::66587"));
//

//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2062L, "1699954391469", "student59 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=242", "student59", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "768", "1366", "768", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=240"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2062L, "1699954391470", "student59 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=242", "student59", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "768", "1366", "768", "PAGE_STAY_TIME_LENGTH:::285820"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2062L, "1699954470374", "student59 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=240", "student59", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "768", "1366", "768", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=232"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2062L, "1699954470376", "student59 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=240", "student59", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "768", "1366", "768", "PAGE_STAY_TIME_LENGTH:::75551"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2063L, "1699954514246", "student60 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=235", "student60", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1600", "775", "1600", "900", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=242"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2063L, "1699954514247", "student60 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=235", "student60", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1600", "775", "1600", "900", "PAGE_STAY_TIME_LENGTH:::433666"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2081L, "1699348566164", "student78 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=150", "student78", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1366", "649", "1366", "768", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2081L, "1699348566165", "student78 rus2", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=150", "student78", "rus2", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1366", "649", "1366", "768", "PAGE_STAY_TIME_LENGTH:::291336"));


//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2269L, "1704706542355", "test 6", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=237", "test", "6", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "2560", "1315", "2560", "1440", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2269L, "1704706542356", "test 6", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=237", "test", "6", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "2560", "1315", "2560", "1440", "PAGE_STAY_TIME_LENGTH:::235451"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2515L, "1709019908715", "student 22 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student", "22", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "736", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2515L, "1709019908716", "student 22 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student", "22", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "736", "1536", "864", "PAGE_STAY_TIME_LENGTH:::378267"));

//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "25", 2542L, "1709125025565", "student 49 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471", "student", "49", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=150"));
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "25", 2542L, "1709125025566", "student 49 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471", "student", "49", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::108320"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2558L, "1709032146896", "student 65 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=153", "student", "65", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1280", "585", "1280", "720", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=154"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2558L, "1709032146897", "student 65 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=153", "student", "65", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1280", "585", "1280", "720", "PAGE_STAY_TIME_LENGTH:::9116"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2559L, "1709033171597", "student 66 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=159", "student", "66", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1318", "646", "1318", "768", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2559L, "1709033171598", "student 66 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=159", "student", "66", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1318", "646", "1318", "768", "PAGE_STAY_TIME_LENGTH:::222255"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2573L, "1709032001897", "student 80 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=154", "student", "80", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1366", "641", "1366", "768", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2573L, "1709032001898", "student 80 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=154", "student", "80", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1366", "641", "1366", "768", "PAGE_STAY_TIME_LENGTH:::12135"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2598L, "1709292481563", "student 105 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "105", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1396", "639", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2598L, "1709292481565", "student 105 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "105", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1396", "639", "1536", "864", "PAGE_STAY_TIME_LENGTH:::68282"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2600L, "1709896318391", "student 107 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student", "107", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1280", "632", "1280", "720", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2600L, "1709896318392", "student 107 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=228", "student", "107", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1280", "632", "1280", "720", "PAGE_STAY_TIME_LENGTH:::873301"));

//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2604L, "1709291648929", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_READING", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=156"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2604L, "1709291648930", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_READING", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::14936"));
//
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "25", 2604L, "1709291689124", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158"));
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "25", 2604L, "1709291689125", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::31140"));
//
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2604L, "1709291810338", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=471"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "25", 2604L, "1709291810339", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=158", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::119899"));


//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2604L, "1710491765932", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
//        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2604L, "1710491765933", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::48521"));
//
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "40", 2604L, "1710491777431", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=230"));
//        traceDataList.add(manuallyCreateOneTraceData("INSTRUCTION", "40", 2604L, "1710491777432", "student 111 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225", "student", "111", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "TASK_REQUIREMENT", "0", "0", "0", "0", "1536", "730", "1536", "864", "PAGE_STAY_TIME_LENGTH:::8779"));

        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2606L, "1709896335743", "student 113 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=234", "student", "113", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "CHANGE_PAGE_CLICK_READING", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "695", "1536", "864", "NEXT_PAGE_URL:::https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=225"));
        traceDataList.add(manuallyCreateOneTraceData("READING", "40", 2606L, "1709896335745", "student 113 q1", "https://nijmegen.floraproject.org/moodle/mod/page/view.php?id=234", "student", "113", "PAGE", "MANUALLY_ADDED_DATA", "NO_TARGET_OBJECT", "LEAVE_PAGE", "RELEVANT_REREADING", "0", "0", "0", "0", "1536", "695", "1536", "864", "PAGE_STAY_TIME_LENGTH:::15185"));


        iTraceDataService.saveBatch(traceDataList);
    }

    @Test
    public void labelCellaStudy1OldData() {
        //Legacy Cella study 1 Oulu Data  course id: 1002   直接跑 labelling 部分
        //Legacy Cella study 1 TUM Data   course id: 1001
        int[] userIdArray1 = {
            1966, 1967, 1968, 1970, 1972, 1973, 1974, 1975, 1977, 1978,
            1986, 1987, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 2005,
            2007, 2010, 2011, 2012, 2014, 2015, 2016, 2098, 2099, 2100,
            2101, 2102, 2103, 2104, 2105, 2106, 2107, 2108, 2109, 2110,
            2111, 2112, 2113, 2115, 2116, 2117, 2118, 2119, 2120, 2121,
            2122, 2123, 2124, 2125, 2126, 2127, 2128, 2129, 2130, 2131,
            2132, 2133, 2134, 2135, 2136, 2137, 2138, 2139, 2140, 2141,
            2143, 2144, 2145, 2146, 2148, 2149, 2150, 2156, 2160, 2161,
            2163, 2165, 2169, 2170, 2191, 2193, 2194, 2199, 2200, 2207,
            2217
        };

        int[] courseIdArray1 = {1001, 1002};
        for (int i = 0; i < userIdArray1.length; i++) {
            for (int j = 0; j < courseIdArray1.length; j++) {
                System.out.println("processing " + userIdArray1[i] + "-----courseid:" + courseIdArray1[j]);
                actionAndProcessService.labelAllProcessLabelPatterns((long) userIdArray1[i], String.valueOf(courseIdArray1[j]), "maria");
            }
        }
    }


}
